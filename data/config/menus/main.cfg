bind ESCAPE [if (cleargui 1) [] [showgui main]]    // it all starts here

newgui main [
    guione [
        guifont "emphasis" [
            guicenter [ guifont "huge" [ guitext "^f(textures/logo)" ] ]
            guistrut 0.5
            guicenter [ guibutton "profile" "showgui profile" ]
            guistrut 0.5
            if (isconnected) [
                if (= (gamemode) $modeidxediting) [
                    guicenter [ guibutton "editing" "showgui editing" ]
                    guistrut 0.5
                ]
                guicenter [ guibutton "disconnect" "disconnect" ]
                if (> (getvote) 0) [ guicenter [ guibutton "show votes" "showgui maps 2" ] ]
                guistrut 0.5
            ]
            guicenter [ guibutton (? (isonline) "find servers" "play online") "showgui servers" ]
            guicenter [ guibutton (? (isconnected) "vote map/mode" "offline practice") "showgui maps 1" ]
            guistrut 0.5
            if (> (ircconns) 0) [ guicenter [ guibutton "irc windows" "showgui irc" ] ]
            guicenter [ guibutton "options" "showgui options" ]
            guicenter [ guibutton "variables" "showgui vars" ]
            guicenter [ guibutton "help" "showgui help" ]
            guistrut 0.5
            guicenter [ guibutton "quit" "quit" ]
        ]
    ]
    guistrut 0.5
    guicenter [ guitip ]
]

guimodes = [
    guicenter [ guitext (modedesc @arg1 @arg2 5) ]
    if (> $arg2 0) [
        loop i $mutsidxnum [
            mut = (<< 1 $i)
            if (&& [& $arg2 $mut] [! (& (mutsimplied $arg1) $mut)]) [
                muttxt = (mutsdesc $arg1 $mut 4)
                if (strlen $muttxt) [ guicenter [ guitext (concatword "^fa" $muttxt) ] ]
            ]
        ]
    ]
]

newgui loading [
    nonworld [ guistayopen [ guinohitfx [
        guione [
            guifont "huge" [ guicenter [ guitext (? (&& (isloadingmap) (strlen $maptitle)) $maptitle "Loading") ] ]
            guifont "default" [ guicenter [ guitext (? (&& (isloadingmap) (strlen $maptitle) (strlen $mapauthor)) (concat "by" $mapauthor) "Please wait") ] ]
            guifont "reduced" [
                if (isloadingmap) [
                    if (isconnected) [
                        gname = (gamename (gamemode) (mutators) 0 32)
                        guicenter [ guitext (format "playing: ^fs^fy%1^fS" $gname) ]
                    ]
                    if (strlen $connectname) [
                        guicenter [ guitext (format "^faon: ^fw%1:[%2]" $connectname $connectport) ]
                        //if (strlen $serverdesc) [ guifont "little" [ guicenter [ guitext (format "^"^fs%1^fS^"" $serverdesc) ] ] ]
                    ]
                ]
            ]
            guistrut 0.5
            guicenter [ guiimage (? (isloadingmap) "" "textures/emblem") [] 7 1 ]
            guistrut 0.5
            if (&& (isloadingmap) (isconnected)) [
                guifont "little" [
                    guicenter [
                        modetexs = (modetexlist (gamemode) (mutators))
                        looplist modetex $modetexs [ guiimage $modetex [] 1 0 "textures/blank" ]
                    ]
                    guimodes (gamemode) (mutators)
                ]
            ]
        ]
        guistrut 0.5
        guicenter [ guitip ]
    ] ] ]
]

newgui about [
    guione [
        guicenter [ guitext "Red Eclipse Engine" ]
        guifont "little" [
            guicenter [ guitext "(C) 2010-2013 Quinton Reeves, Lee Salzman" ]
            guicenter [ guitext "http://www.redeclipse.net/" ]
        ]
        guistrut 1
        guicenter [ guitext "Red Eclipse Data" ]
        guifont "little" [
            guicenter [ guitext "(C) 2010-2013 Red Eclipse Team" ]
            guicenter [ guitext "http://www.redeclipse.net/" ]
        ]
        guistrut 1
        guicenter [ guitext "Based on Cube Engine 2" ]
        guifont "little" [
            guicenter [ guitext "(C) 2001-2013 Wouter van Oortmerssen, Lee Salzman" ]
            guicenter [ guitext "Mike Dysart, Robert Pointon, and Quinton Reeves" ]
            guicenter [ guitext "http://sauerbraten.org/" ]
        ]
    ]
]

newgui support [
    ircgui freenode
] [
    if (= $guipasses 0) [
        ircaddclient freenode irc.freenode.net 6667 (getplayername)
        ircaddchan freenode #redeclipse
    ]
]

newgui help [
    guione [
        guifont "emphasis" [
            guicenter [ guibutton "about" "showgui about" ]
            guicenter [ guibutton "live support" "showgui support" ]
        ]
    ]
]
