// standard menu definitions

bind ESCAPE [if (cleargui 1) [] [showgui main]]    // it all starts here

textlogo = [ guifont "super" [ guitext "^frRed Eclipse" ] ]

vardef = [ guitext (format "%1" $arg2); (format "%1val" $arg1) = $$arg1 ]
varhdef = [ guitext (format "%1" $arg2); (format "%1val" $arg1) = (hexcolour $$arg1) ]
varfld = [ varname = (format "%1val" $arg1); guifield $varname $arg2 [@arg1 $@varname] ]
varbit = [ varname = (format "%1val" $arg1); guibitfield "" $varname $arg2 [@arg1 $@varname] ]
vardef2 = [ guitext (format "%1" $arg2); (format "%1val1" $arg1) = $(format "%11" $arg1); (format "%1val2" $arg1) = $(format "%12" $arg1) ]
varhdef2 = [ guitext (format "%1" $arg2); (format "%1val1" $arg1) = (hexcolour $(format "%11" $arg1)); (format "%1val2" $arg1) = (hexcolour $(format "%12" $arg1)) ]
varfld2 = [ guilist [ varname1 = (format "%1val1" $arg1); guifield $varname1 $arg2 [@(format "%11" $arg1) $@varname1]; varname2 = (format "%1val2" $arg1); guifield $varname2 $arg2 [@(format "%12" $arg1) $@varname2] ] ]
varbit2 = [ guilist [ varname1 = (format "%1val1" $arg1); guibitfield "" $varname1 $arg2 [@(format "%11" $arg1) $@varname1]; varname2 = (format "%1val2" $arg1); guibitfield "" $varname2 $arg2 [@(format "%12" $arg1) $@varname2] ] ]
varincr = [ guilist [ varname1 = (format "%1val1" $arg1); guibutton "^fy-" [@(format "%11" $arg1) (- $@varname1 1)]; guifield $varname1 $arg2 [@(format "%11" $arg1) $@varname1]; guibutton "^fg+" [@(format "%11" $arg1) (+ $@varname1 1)]; varname2 = (format "%1val2" $arg1); guifield $varname2 $arg2 [@(format "%12" $arg1) $@varname2] ] ]

guicomb = [ guilist [ guilist [ arg1 ] ] ]
guibox = [
    guilist [ guistrut 70 ]
    guilist [
        guiimage "textures/emblem" $arg1 7.5 1 "textures/nothumb"
        guistrut $arg2
        guilist [
            guistrut 0.5
            textlogo
            guistrut 0.5
            arg3
        ]
        arg4
    ]
]

guimerge = [ guibody [guilist [guilist [guistrut $arg1]; guilist [arg2]]] $arg3 $arg4 ]
guiarea = [
    guilist [
        if (> $numargs 9) [ arg10 ]
        guilist [
            (format "%1count" $arg1) = $arg2
            (format "%1disp" $arg1) = 0
            (format "%1list" $arg1) = 0
            guilist [
                guistrut 0.5
                guilist [ guistrut $arg3 ]
                if (arg5) [
                    (format "%1num" $arg1) = $arg6
                    if (> $(format "%1num" $arg1) 0) [
                        (format "%1index" $arg1) = (min (max 0 (- $(format "%1num" $arg1) $(format "%1count" $arg1))) $(format "%1index" $arg1)) //safeguard
                        loop i $(format "%1num" $arg1) [
                            arg7
                            if (arg8) [
                                if (&& (>= $i $(format "%1index" $arg1)) (< $(format "%1list" $arg1) $(format "%1count" $arg1))) [
                                    arg11
                                    (format "%1list" $arg1) = (+ $(format "%1list" $arg1) 1)
                                ]
                                (format "%1disp" $arg1) = (+ $(format "%1disp" $arg1) 1)
                            ]
                        ]
                    ] [ guistrut (-f (*f $arg4 $arg2) 1); arg9; (format "%1list" $arg1) = $arg2 ]
                ] [ guistrut (-f (*f $arg4 $arg2) 1); arg9; (format "%1list" $arg1) = $arg2 ]
                (format "%1alts" $arg1) = (- $(format "%1count" $arg1) $(format "%1list" $arg1))
                if (> $(format "%1alts" $arg1) 0) [ guistrut (*f $(format "%1alts" $arg1) $arg4) ]
            ]
            guistrut 2
            guislider (format "%1index" $arg1) 0 (max (- $(format "%1disp" $arg1) $(format "%1count" $arg1)) 0) [] 1 1
        ]
        if (> $numargs 11) [ arg12 ]
    ]
]
guipage = [ guistayopen [guiarea $arg1 $arg2 $arg3 $arg4 $arg5 $arg6 $arg7 $arg8 $arg9 $arg10 $arg11 $arg12] ]
guicontainer = [ guilist [guilist [if (arg1) [arg2] [arg3]]] ]

tipstr = (showtip)
guitip = [
    if (> $numargs 0) [ tipstr = $arg1 ] [ tipstr = (showtip) ]
    guistayopen [ guibody [
        guistrut 0.5
        guitext "TIP: "
        guifont "little" [ guitext (format "^fa%1" $tipstr) ]
    ] [ lasttip = 0 ] [ lasttip = 0 ] ]
]

newgui main [
    guicomb [
        guicomb [ guitip ]
        guistrut 0.5
        guibox "showgui servers" 3 [
            guifont "default" [
                guibutton "profile" "showgui profile"
                guistrut 0.5
                if (isconnected) [
					if (= (gamemode) 1) [
						guibutton "editing" "showgui editing"
						guistrut 0.5
					]
                    guibutton "disconnect" "disconnect"
                    if (> (getvote 0) 0) [ guibutton "show votes" "showgui maps 2" ]
                    guistrut 0.5
                ]
                guibutton (? (isonline) "find servers" "play online") "showgui servers"
                guibutton (? (isconnected) "vote map/mode" "offline practice") "showgui maps 1"
                guistrut 0.5
                if (> (ircconns) 0) [ guibutton "irc windows" "showgui irc" ]
                guibutton "options" "showgui options"
                guibutton "variables" "showgui vars"
                guibutton "help" "showgui help"
                guistrut 0.5
                guibutton "quit" "quit"
            ]
        ] [ guistrut 14 ]
        guistrut 0.5
        guilist [
            guistrut 0.5
            guilist [
                guifont "little" [
                    cases (? (strlen $guirolloverimgaction) $guirolloverimgaction $guirolloveraction) "showgui servers" [
                        guitext "^fadisplays the server browser for other online matches"
                    ] "showgui profile" [
                        guitext "^faedit your name, colour, and model type"
                    ] "showgui editing" [
                        guitext "^faaccess commands to use while editing a map"
                    ] "showgui irc" [
                        guitext "^fashows your open irc windows"
                    ]  "disconnect" [
                        guitext "^fadisconnects your current connection"
                    ] "showgui maps 2" [
                        guitext "^fadisplays the current votes"
                    ] "showgui maps 1" [
                        guitext (format "^faselect a map/mode combination to %1" (? (isonline) "vote for" "practice on"))
                    ] "showgui options" [
                        guitext "^faedit your configuration options"
                    ] "showgui vars" [
                        guitext "^faedit gameplay and weapon variables"
                    ] "showgui help" [
                        guitext "^fagets some help!"
                    ] "quit" [
                        guitext "^facloses Red Eclipse"
                    ] () [
                        guitext "^faclick on an activity to start"
                    ]
                ]
            ]
        ]
    ]
]

guimodes = [
	guitext (modedesc $arg1 $arg2 5)
	if (> $arg2 0) [
		loop i $maxmuts [
			if (|| (!= $i 1) (! (& $arg2 (<< 1 0)))) [
				mut = (<< 1 $i)
				if (& $arg2 $mut) [
					desc = (mutsdesc $arg1 $mut 4)
					if (strlen $desc) [ guitext (concatword "^fa" $desc) ]
				]
			]
		]
	]
]

newgui loading [
    guicomb [
        guicomb [ guitip ]
        guistrut 0.5
        guilist [
            guiimage "" [] 7.5 1
            guistrut 2
            guilist [
                guistrut 0.5
                textlogo
                guistrut 0.5
				guifont "default" [ guitext (? (strlen $maptitle) $maptitle "Loading..") ]
				guifont "reduced" [
					guilist [
						guistrut 1
						guitext (? (strlen $maptitle) (format "^faby %1" (? (strlen $mapauthor) $mapauthor "Unknown")) "Please wait..")
					]
				]
                guifont "little" [
					if (strlen $connectname) [ guitext (format "^faon: ^fw%1:[%2]" $connectname $connectport) ]
					if (isconnected) [
						gname = (gamename (gamemode) (mutators))
						if (> (strlen $gname) 40) [ gname = (gamename (gamemode) (mutators) 1) ]
						guitext (format "playing: [ ^fs^fa%1^fS ]" $gname)
						guilist [
							modetexs = (modetexlist (gamemode) (mutators))
							guinohitfx [ looplist modetex $modetexs [ guiimage $modetex [] 1 0 "textures/blank" ] ]
						]
						guicomb [ guimodes (gamemode) (mutators) ]
					]
                ]
            ]
        ]
    ]
]

ircident = 0

newgui irc [
    guistayopen [
        guitext "saved identities"
        guislider ircident 0 10
        guilist [
            guilist [
                guitext "network  "
                guitext "address  "
                guitext "port     "
                guitext "nickname "
                guitext "channel  "
            ]
            guilist [
                guilist [
                    guifield ircname@ircident -40
                    guistrut 1
                    guibutton "connect" [
                        ircaddclient $[ircname@ircident] $[irchost@ircident] $[ircport@ircident] $[ircnick@ircident]
                        ircaddchan $[ircname@ircident] $[ircchan@ircident]
                    ]
                ]
                guifield [irchost@ircident] -40
                guifield [ircport@ircident] -40
                guifield [ircnick@ircident] -40
                guilist [
                    guifield [ircchan@ircident] -40
                    guistrut 1
                    guibutton "join" [ ircaddchan $[ircname@ircident] $[ircchan@ircident] ]
                ]
            ]
        ]
    ]
    guibar
    ircgui
] [
    if (= $guipasses 0) [
        ircname0 = freenode
        irchost0 = irc.freenode.net
        ircport0 = 6667
        ircnick0 = (at (getname) 0)
        ircchan0 = #redeclipse
    ]
]

newgui about [
    guibox "cleargui 1" 3 [
        guifont "default" [ guitext "(C) 2009-2011" ]
        guifont "little" [
            guitext "Quinton Reeves, Lee Salzman"
            guitext "http://www.redeclipse.net/"
        ]
        guistrut 1
        guitext "Based on Cube Engine 2"
        guifont "default" [ guitext "(C) 2001-2011" ]
        guifont "little" [
            guitext "Wouter van Oortmerssen, Lee Salzman"
            guitext "  Mike Dysart, Robert Pointon, and Quinton Reeves"
            guitext "http://sauerbraten.org/"
        ]
    ] []
]

newgui support [
    ircgui freenode
] [
    if (= $guipasses 0) [
        ircaddclient freenode irc.freenode.net 6667 (getname)
        ircaddchan freenode #redeclipse
    ]
]

newgui help [
    guibox "cleargui 1" 3 [
        guifont "default" [
            guibutton "about" "showgui about"
            guibutton "live support" "showgui support"
        ]
    ] []
]

newgui test [guilist [loop i 20 [guilist [loop j 20 [textlogo]]]]]

shownmapgui = 0
shownservergui = 0
mapselected = 0
mutsselected = 0
modeselected = 3
mutsbefore = -1
lastmode = -1
lastmuts = -1

newgui profile [
    guibox "cleargui 1" 3 [
        guifont "default" [ guitext "^faPlease enter your details" ]
        guistrut 1
        guilist [
            guitext "name:  "
            guifield nameval 24 []
        ]
        guistrut 1
		guilist [
			guitext "model: "
			guiradio "male" modlval 0
			guistrut 1
			guiradio "female" modlval 1
		]
		guistrut 1
        guilist [
            colr = (& (>> $colrval 16) 0xFF)
            colg = (& (>> $colrval 8) 0xFF)
            colb = (& $colrval 0xFF)
            guicomb [
                guicomb [
                    guibackground $colrval
                    guistrut 5.5
                    guilist [ guistrut 3 ]
                ]
                guistrut 1
                guilist [
                    guicomb [
                        guilist [ guistrut 25.5 ]
                        guislider colr 0 255 [colrval = (| (| (<< $colr 16) (<< $colg 8)) $colb)] 0 1 0xFF0000
                    ]
                    guistrut 0.15
                    guicomb [
                        guilist [ guistrut 25.5 ]
                        guislider colg 0 255 [colrval = (| (| (<< $colr 16) (<< $colg 8)) $colb)] 0 1 0x00FF00
                    ]
                    guistrut 0.15
                    guicomb [
                        guilist [ guistrut 25.5 ]
                        guislider colb 0 255 [colrval = (| (| (<< $colr 16) (<< $colg 8)) $colb)] 0 1 0x0000FF
                    ]
                ]
            ]
        ]
        guistrut 1
        guilist [
            guistrut 1
            guibutton "^fgok" [setinfo $nameval $colrval $modlval; cleargui 1] [] "action"
            guistrut 1
            guibutton "^frcancel" [cleargui 1] [] "exit"
        ]
    ] []
] [
    if (= $guipasses 0) [
        nameval = (getname)
        colrval = (getcolour -1)
		modlval = (getmodel)
    ]
]

weapname = [ "melee" "pistol" "sword" "shotgun" "smg" "flamer" "plasma" "rifle" "grenade" "rocket" "action" ]

loadweapa = -1
loadweapb = -1
loadweapon = [
    a = $$arg4
    if (&& (!= $a $arg3) (allowedweap $arg3)) [
        guiradio (format "^f[%1]^f(%2)%3" $arg5 $arg6 $arg1) $arg2 $arg3
    ] [
        guilist [
            guilist [ guistrut 0.25; guilist [ guistrut 0.25; guiimage "textures/checkdisable" [] 0.375 0 "textures/blank" ] ]
            guistrut 0.5
            guitext (format "^f[%1]^f(%2)^fe%3" $arg5 $arg6 $arg1)
        ]
    ]
]
newgui loadout [
    guicomb [
        guicomb [ guitip (format "press ^fs^fc%1^fS to open this menu at any time" (searchbinds "showgui loadout" 5 "or" "^fw")) ]
        guibox "cleargui 1" 4 [
            if (& (mutators) (<< 1 7)) [
                guifont "default" [ guitext "choose weapon" ]
                guistrut 1
                guifont "reduced" [
                    guilist [
                        guilist [
                            guiradio "^fg^f(textures/question)random" loadweapa 0
                            loadweapon $swordname loadweapa 2 loadweapb $swordcolour "textures/sword"
                            loadweapon $shotgunname loadweapa 3 loadweapb $shotguncolour "textures/shotgun"
                            loadweapon $smgname loadweapa 4 loadweapb $smgcolour "textures/smg"
                            loadweapon $flamername loadweapa 5 loadweapb $flamercolour "textures/flamer"
                            loadweapon $plasmaname loadweapa 6 loadweapb $plasmacolour "textures/plasma"
                            loadweapon $riflename loadweapa 7 loadweapb $riflecolour "textures/rifle"
                            if (& (mutators) 0x1000) [
                                loadweapon $grenadename loadweapa 8 loadweapb $grenadecolour "textures/grenade"
                                loadweapon $rocketname loadweapa 9 loadweapb $rocketcolour "textures/rocket"
                            ]
                        ]
						guistrut 2
						guilist [
							guiradio "^fg^f(textures/question)random" loadweapb 0
							loadweapon $swordname loadweapb 2 loadweapa $swordcolour "textures/sword"
							loadweapon $shotgunname loadweapb 3 loadweapa $shotguncolour "textures/shotgun"
							loadweapon $smgname loadweapb 4 loadweapa $smgcolour "textures/smg"
							loadweapon $flamername loadweapb 5 loadweapa $flamercolour "textures/flamer"
							loadweapon $plasmaname loadweapb 6 loadweapa $plasmacolour "textures/plasma"
							loadweapon $riflename loadweapb 7 loadweapa $riflecolour "textures/rifle"
						]
                    ]
                ]
                guistrut 1
                guilist [
                    guifont "reduced" [ guibutton "^frcancel" [cleargui 1] ]
                    guistrut 1
					guifont "reduced" [ guistayopen [ guibutton "^fyswap" [ll = $loadweapb; loadweapb = $loadweapa; loadweapa = $ll] ] ]
					guistrut 1
                    guifont "default" [ guibutton "^fgsubmit" [loadweap $loadweapa $loadweapb] ]
                ]
            ] [
                guifont "deafault" [ guitext "sorry" ]
                guistrut 1
                guifont "reduced" [ guilist [ guistrut 1; guitext "^frthis is only available with arena" ] ]
                guistrut 1
                guifont "default" [ guibutton "^fgclose" [cleargui 1] ]
            ]
        ] []
    ]
] [
    if (= $guipasses 0) [
        loadweapa = (getloadweap 0)
        loadweapb = (getloadweap 1)
    ]
]

newgui team [
    guicomb [
        guicomb [ guitip (format "press ^fs^fc%1^fS to open this menu at any time" (searchbinds "showgui team" 5 "or" "^fw")) ]
        guibox "cleargui 1" 3 [
            if (&& (> (gamemode) 2) (& (mutators) (<< 1 1))) [
                guifont "default" [ guitext "choose team" ]
                guistrut 1
                guifont "reduced" [
                    guibutton (format "^f[%1]%2" $teamalphacolour $teamalphaname) [team 1] [] "teamalpha" $teamalphacolour
                    guibutton (format "^f[%1]%2" $teamomegacolour $teamomeganame) [team 2] [] "teamomega" $teamomegacolour
					if (& (mutators) (<< 1 0)) [
						guibutton (format "^f[%1]%2" $teamkappacolour $teamkappaname) [team 3] [] "teamkappa" $teamkappacolour
						guibutton (format "^f[%1]%2" $teamsigmacolour $teamsigmaname) [team 4] [] "teamsigma" $teamsigmacolour
					]
                ]
                guistrut 1
                guifont "default" [ guibutton "^frcancel" [cleargui 1] [] "action" ]
            ] [
                guifont "default" [ guitext "sorry" ]
                guistrut 1
                guifont "reduced" [ guilist [ guistrut 1; guitext "^frthis is only available in team games" ] ]
                guistrut 1
                guifont "default" [ guibutton "^fgclose" [cleargui 1] [] "action" ]
            ]
        ] []
    ]
]

maplists = [ campaignmaps mainmaps capturemaps defendmaps bombermaps trialmaps ]
mapindex = 0
lastmode = -1
lastmuts = -1
mapnum = -1
mapcur = ""
maplist = ""
mappath = ""
mapextra = ""
mapimg = ""
mapocta = 0
shownmapgui = 0

mapsmenuinit = [
    if (< (gamemode) 2) [ modeselected = -1 ] [ modeselected = (gamemode) ]
    if (< (mutators) 0) [ mutsselected = 0 ] [ mutsselected = (mutscheck $modeselected (mutators)) ]
    mapindex = 0
    lastmode = -1
    lastmuts = -1
    mapnum = -1
    mapcur = ""
    maplist = ""
    mappath = ""
    mapextra = ""
    mapimg = ""
    mapocta = 0
    shownmapgui = 0
    mutsbefore = $mutsselected
]
mapsmenuiter = [
    if (&& (>= $modeselected 0) (|| (!= $lastmode $modeselected) (!= $lastmuts $mutsselected) (!= $shownmapgui 1))) [
        mutsselected = (mutscheck $modeselected $mutsselected)
        maplist = ""
        mappath = ""
        if (> $modeselected 1) [
            list = (getmaplist $modeselected $mutsselected (? (isonline) (listlen (listclients 1)) 0))
            looplist lcurmap $list [
                maplist = (concat $maplist $lcurmap)
                mappath = (concat $mappath (concatword "maps/" $lcurmap))
            ]
        ]
        mapcount = (listlen $maplist)
        if (!= $modeselected 2) [
            maplist = (concat $maplist "*")
            mappath = (concat $mappath "*");
            loopfiles lcurmap maps mpz [
                if (< (listfind mcurmap $maplist [strcmp $mcurmap $lcurmap]) 0) [
                    maplist = (concat $maplist $lcurmap)
                    mappath = (concat $mappath (concatword "maps/" $lcurmap))
                ]
            ]
            if (&& (> $hasoctapaks 0) (> $mapocta 0)) [
                loopfiles lcurmap base ogz [
                    maplist = (concat $maplist $lcurmap)
                    mappath = (concat $mappath (concatword "base/" $lcurmap))
                ]
            ]
        ]
        maplist = (concat $maplist "?")
        mappath = (concat $mappath "?");
        if (= (strlen $mapcur) 0) [ mapcur = $mapname ]
        mapnum = (listfind curmap $maplist [(|| (strcmp $curmap $mapcur) (strcmp (concatword "maps/" $curmap) $mapcur) (&& (> $hasoctapaks 0) (> $mapocta 0) (strcmp (concatword "base/" $curmap) $mapcur)))])
        if (|| (< $mapnum 0) (>= $mapnum $mapcount)) [ mapnum = (rnd $mapcount) ]
        if (strcmp "*" (at $maplist $mapnum)) [ mapnum = (- (listlen $maplist) 1); mapextra = $mapname ]
        lastmode = $modeselected
        lastmuts = $mutsselected
        mapindex = 0
        shownmapgui = 1
    ]
    if (strcmp (at $maplist $mapnum) "?") [ mapcur = $mapextra; mapimg = $mapextra ] [ mapcur = (at $maplist $mapnum); mapimg = (at $mappath $mapnum) ]
]

mutsvar = [
    if (> (strlen $arg1) 0) [
        guistayopen [ guilist [
            g = 0; g = $$arg2
            m = 0; m = $$arg3
            if (& (mutsimplied $g $m) $arg4) [
                guibutton $arg1 [ implied = @arg4 ] [] "checkboxtwo"
            ] [
                if (&& (|| (= $mutslockfilter 0) (! (isonline)) (< $modelock 3) (? (= $modelock 4) (isadmin (getclientnum)) (ismaster (getclientnum))) (& $mutslockfilter $arg4)) (& (mutscheck $g (| $m $arg4) $arg4) $arg4)) [
                    if (& $m $arg4) [
                        guibutton $arg1 [ mutate = @arg4 ; @arg3 = (mutscheck $g (- $m @arg4)) ] [] "checkboxon"
                    ] [
                        guibutton $arg1 [ mutate = @arg4 ; @arg3 = (mutscheck $g (| $m @arg4) @arg4) ] [] "checkbox"
                    ]
                ] [
                    guibutton $arg1 [ disabled = @arg4 ] []  "checkdisable"
                ]
            ]
        ] ]
    ] [ guistrut 1 ]
]

modevar = [
    guistayopen [ guilist [
        if (|| (= $modelockfilter 0) (! (isonline)) (< $modelock 3) (? (= $modelock 4) (isadmin (getclientnum)) (ismaster (getclientnum))) (& (<< 1 $arg3) $modelockfilter)) [
            g = $$arg2
            if (= $g $arg3) [
                guibutton $arg1 [ @arg2 = @arg3 ] [] "checkboxon"
            ] [
                guibutton $arg1 [ @arg2 = @arg3 ] [] "checkbox"
            ]
        ] [
            guitext $arg1 "checkdisable"
        ]
    ] ]
]

mapsmenu = [
    guilist [
        guilist [ guistrut 74 ]
        guicomb [ guitip (format "press ^fs^fc%1^fS to open this menu at any time" (searchbinds "showgui maps 1" 5 "or" "^fw")) ]
        guistrut 0.5
        guilist [
            guilist [
                guilist [
                    guilist [ guistrut 3 ]
                    guilist [
                        if (< $lastmode 0) [
                            guitext "game select"
                            guifont "little" [ guitext "^faplease select a mode and map to continue" ]
                        ] [
                            gname = (gamename $modeselected $mutsselected)
                            if (> (strlen $gname) 32) [ gname = (gamename $modeselected $mutsselected 1) ]
                            guitext $gname
                            guilist [ guitext " ^faselected on "; guitext $mapcur ]
                        ]
                    ]
                ]
                guilist [
                    guilist [
                        guitext "gamemode"
                        guistrut 1
                        guifont "little" [
                            modevar "editing" modeselected 1
                            modevar "campaign" modeselected 2
                            modevar "deathmatch" modeselected 3
                            modevar "capture-the-flag" modeselected 4
                            modevar "defend-the-flag" modeselected 5
                            modevar "bomber-ball" modeselected 6
                            modevar "time-trial" modeselected 7
                        ]
                    ]
                    guistrut 3
                    guilist [
                        guistayopen [
                            guiimage (format "%1" $mapimg) [if (>= @lastmode 0) [ start @@mapcur @@modeselected @@mutsselected ]] 5 1 "textures/emblem"
                        ]
                    ]
                ]
                guistrut 0.5
                guifont "reduced" [ guitext "mutators" ]
                guistrut 0.5
                guilist [
                    guifont "little" [
                        guilist [
                            mutsvar "multi" modeselected mutsselected (<< 1 0)
                            mutsvar "medieval" modeselected mutsselected (<< 1 3)
                            mutsvar "survivor" modeselected mutsselected (<< 1 6)
                            mutsvar "hover" modeselected mutsselected (<< 1 9)
                            mutsvar "expert" modeselected mutsselected (<< 1 12)
                        ]
                        guistrut 3
                        guilist [
                            mutsvar "teamplay" modeselected mutsselected (<< 1 1)
                            mutsvar "ballistic" modeselected mutsselected (<< 1 4)
                            mutsvar "arena" modeselected mutsselected (<< 1 7)
                            mutsvar "jetpack" modeselected mutsselected (<< 1 10)
                            mutsvar "resize" modeselected mutsselected (<< 1 13)
                        ]
                        guistrut 3
                        guilist [
                            mutsvar "instagib" modeselected mutsselected (<< 1 2)
                            mutsvar "duel" modeselected mutsselected (<< 1 5)
                            mutsvar "onslaught" modeselected mutsselected (<< 1 8)
                            mutsvar "vampire" modeselected mutsselected (<< 1 11)
                        ]
                    ]
                ]
                if (> (strlen (gspmutname $modeselected 0)) 0) [
                    guistrut 0.5
                    guifont "little" [ guitext "mode specific" ]
                    guistrut 0.5
                    guilist [
                        guifont "little" [
                            guilist [
                                mutsvar (gspmutname $modeselected 0) modeselected mutsselected (<< 1 14)
                            ]
                            guistrut 3
                            guilist [
                                mutsvar (gspmutname $modeselected 1) modeselected mutsselected (<< 1 15)
                            ]
                            guistrut 3
                            guilist [
                                mutsvar (gspmutname $modeselected 2) modeselected mutsselected (<< 1 16)
                            ]
                        ]
                    ]
                ]
            ]
            guistrut 1
            mapscount = 20
            guilist [
                guilist [
					guitext "available maps"
					if (> $hasoctapaks 0) [
						guispring
						guistayopen [
							guibutton "show sauer maps" [
								if (> $mapocta 0) [mapocta = 0] [mapocta = 1]
								shownmapgui = 0
							] [] (? (> $mapocta 0) "checkboxon" "checkbox")
						]
						guistrut 1
					]
				]
				guistrut 0.25
                guilist [
                    guifont "little" [
                        guicontainer [>= $lastmode 0] [
                            nummaps = (- (listlen $maplist) 1)
                            guilist [
                                guilist [
                                    guilist [ guistrut $mapscount ]
                                    mapindex = (min (max 0 (- $nummaps $mapscount)) $mapindex) //safeguard
                                    mapnum = (min $mapnum $nummaps)
                                    guilist [
                                        guilist [ guistrut 34 ]
                                        break = 0
                                        loopwhile i $mapscount [if (= $break 0) [ 1 ] [ 0 ]] [
                                            q = (+ $mapindex $i)
                                            curmap = (at $maplist $q)
                                            if (strcmp $curmap "*") [
                                                guifont "little" [ guitext "maps not in the rotation" ]
                                            ] [
                                                if (strcmp $curmap "?") [ break = 1 ] [ guiradio $curmap mapnum $q ]
                                            ]
                                        ]
                                    ]
                                ]
                                guilist [ guifont "little" [ guitext "^custom map" ] ]
                                guilist [
                                    guiradio "" mapnum $nummaps
                                    mapextraval = $mapextra
                                    guifield mapextraval 32 [mapextra = $mapextraval]
                                ]
                            ]
                            guislider mapindex 0 (max (- $nummaps $mapscount) 0) [] 1 1
                        ] [ guistrut 38; guilist [ guistrut (+f $mapscount 3.5) ] ]
                    ]
                ]
            ]
        ]
        guistrut 0.25
        guilist [
            if (>= $lastmode 0) [
                guistrut 48
                guifont "super" [
                    guistayopen [
                        guibutton (? (isonline) "^fgsubmit vote" "^fgstart game") (format "showgui maps 2; sleep 100 [ start %1 %2 %3 ]" $mapcur $modeselected $mutsselected)
                    ]
                ]
            ] [ guistrut 1 ]
        ]
		guistrut 0.25
        guilist [
            guistrut 0.5
            guilist [
                guifont "small" [
					act = (? (strlen $guirolloverimgaction) $guirolloverimgaction $guirolloveraction)
                    cases (at $act 0) "modeselected" [
                        guitext (format "^fa%1" (modedesc (at $act 2) $mutsselected 3))
                    ] "mutate" [
						guitext (format "^fa%1" (mutsdesc $modeselected (at $act 2) 3))
                    ]  "implied" [
						guitext "^fathis mutator is implied in the current configuration"
                    ]  "disabled" [
						guitext "^fathis mutator is disabled in the current configuration"
                    ]() [ guitext "^fahover over a mode or mutator to see its description" ]
                ]
            ]
        ]
    ]
]

voteindex = 0
votenum = 0
votemenuinit = [ voteindex = 0 ]
votemenu = [
    guipage vote 6 74 4.2 [1] (getvote 0) [vote = (getvote (+ $i 1))] [1] [guibutton "^fwThere are no votes currently pending, ^fgsubmit ^fwone yourself" [showgui maps 1] [] "chat"] [
        guicomb [ guitip (format "press ^fs^fc%1^fS to open this menu at any time" (searchbinds "showgui maps 2" 5 "or" "^fw")) ]
        guistrut 0.5
        guilist [
            guicheckbox "^fcdynamic sort" sortvotes; guistrut 1.5
            guicheckbox "^focleanup list" cleanvotes; guistrut 1.5
            guibutton "^fyclear vote" clearvote; guistrut 1.5
			guispring
			guitext (format "^fd[ ^fc%1 ^fw%2 ^fd]" $votenum (? (= $votenum 1) "vote" "votes" ))
			guistrut 3.5
        ]
    ] [
        voteplayers = (at $vote 0)
        votemode = (at $vote 1)
        votemuts = (at $vote 2)
        votemap = (at $vote 3)
        votegame = (at $vote 1)
        voteself = 0
        loop j $voteplayers [ if (= (getclientnum) (getvote (+ $i 1) (+ $j 1))) [ voteself = 1 ] ]
        guistrut 0.125
        guimerge 74 [
            guilist [
                guistrut 1.25
                guilist [ guistrut 4.5 ]
                votecolour = "^fw"
                if (= $voteself 1) [ votecolour = "^fy" ]
                guifont "default" [ guibutton (format "%1%2" $votecolour $voteplayers) ]
                guifont "little" [ if (= $voteplayers 1) [ guibutton (format "%1vote" $votecolour) ] [  guibutton (format "%1votes" $votecolour) ] ]
            ]
            voteimage = "textures/chat"
            votepath = (listfind curmap $maplist [(|| (strcmp $curmap $votemap) (strcmp (concatword "maps/" $curmap) $votemap) (&& (> $hasoctapaks 0) (> $mapocta 0) (strcmp (concatword "base/" $curmap) $votemap)))])
            if (> $votepath -1) [ voteimage = (at $mappath $votepath) ]
            guiimage $voteimage "" 2 1 "textures/chat"
            guistrut 1
            guilist [
                guistrut 0.5
                gname = (gamename $votemode $votemuts)
                if (> (strlen $gname) 32) [ gname = (gamename $votemode $votemuts 1) ]
                guifont "reduced" [ guibutton (format "^fy%1" $gname) ]
                guistrut 0.125
                guilist [
                    guistrut 2
                    guifont "little" [ guibutton " ^favoted for on " ]
                    guifont "reduced" [ guibutton (format "^fo%1" $votemap) ]
                ]
                guilist [
                    if (> $voteplayers 0) [
                        guifont "reduced" [ guibutton "^fwby" ]
                        pname = ""
                        pmore = 0
                        loop j $voteplayers [
                            if (> (strlen $pname) 64) [ pmore = (+ $pmore 1) ] [
                                if (= $j 0) [ guibutton " " ] [
                                    if (= $j (- $voteplayers 1)) [
                                        pname = (format "%1 ^faand " $pname)
                                    ] [ pname = (format "%1^fa, " $pname) ]
                                ]
                                pname = (format "%1%2" $pname (getclientname (getvote (+ $i 1) (+ $j 1)) 1))
                            ]
                        ]
                        if (> $pmore 0) [ pname = (format "%1 ^faand ^fy%2 ^famore" $pname $pmore) ]
                        guifont "little" [ guibutton $pname ]
                    ] [ guifont "reduced" [ guibutton "^fano current votes" ] ]
                ]
            ]
        ] [
            if (= @voteself 1) [ clearvote ] [ start @@votemap @@votemode @@votemuts ]
        ] []
        guistrut 0.125
    ]
]

newgui maps [
    mapsmenuiter
    guilist [ mapsmenu ]
    guitab "votes"
    guilist [ votemenu ]
] [
    if (= $guipasses 0) [
        mapsmenuinit
        votemenuinit
    ]
]

varslist1 = [ maprotate spawnrotate selfdamage trialdamage teamdamage spawnhealth maxhealth maxhealthvampire actorscale minresizescale maxresizescale maxcarry regenhealth kamikaze pointlimit capturelimit captureresetdelay ]
varslist2 = [ defendlimit defendpoints defendoccupy defendflags bomberlimit bomberresetdelay bomberspeed gamespeed gravityforce liquidspeedforce liquidcurbforce floorcurbforce aircurbforce slidecurbforce movespeed movecrawl movesprint movehover movestraight movestrafe moveinair movestepup movestepdown jumpspeed impulsespeed impulselimit impulseboost ]
varslist3 = [ impulsedash impulsejump impulsemelee impulseparkour impulseparkournorm impulseallowed impulsestyle impulsecount impulsedelay impulseslide impulsemeter impulsecost impulseskate impulsesprint impulsehover impulseregen impulseregencrouch impulseregensprint impulseregenhover impulseregenmove impulseregeninair damagescale criticalchance ]
varslist4 = [ itemsallowed hitpushscale hitslowscale deadpushscale wavepushscale waveslowscale timelimit triallimit intermlimit votelimit duelreset duelclear duellimit itemspawntime itemspawndelay itemspawnstyle itemthreshold regendelay regentime enemyspawntime enemyspawndelay enemyspawnstyle spawngrenades spawnweapon instaweapon ]
varsmenu = [
    guifont "little" [
        guilist [
            guilist [
                guilist [ looplist var $varslist1 [ vardef $var $var ] ]
                guistrut 2
                guilist [ looplist var $varslist1 [ varfld $var 8 ] ]
            ]
        ]
        guistrut 3
        guilist [
            guilist [
                guilist [ looplist var $varslist2 [ vardef $var $var ] ]
                guistrut 2
                guilist [ looplist var $varslist2 [ varfld $var 8 ] ]
            ]
        ]
        guistrut 3
        guilist [
            guilist [
                guilist [ looplist var $varslist3 [ vardef $var $var ] ]
                guistrut 2
                guilist [ looplist var $varslist3 [ varfld $var 8 ] ]
            ]
        ]
        guistrut 3
        guilist [
            guilist [
                guilist [ looplist var $varslist4 [ vardef $var $var ] ]
                guistrut 2
                guilist [ looplist var $varslist4 [ varfld $var 8 ] ]
            ]
            guistrut 0.5
            guistayopen [ guilist [ guistrut 4; guifont "little" [ guibutton "^foreset all game variables" [resetvars] ] ] ]
        ]
    ]
]

weapcount = 10
weapindex = 0
weapmenuinit = [ weapindex = 0 ]
weapindexdelta = [
    weapindex = (+ $weapindex $arg1)
    if (< $weapindex 0) [ weapindex = (+ $weapindex $weapcount) ]
    if (>= $weapindex $weapcount) [ weapindex = (- $weapindex $weapcount) ]
]
weapmenu = [
    guistayopen [
        guilist [
            weapname = (getweap $weapindex -1)
            guilist [
                guiimage (getweap $weapindex 1) [weapindexdelta 1] 1.25 0 "textures/nothumb"
                guistrut 0.5
                guilist [
                    guifont default [ guitext (format "%1 (%2/%3)" $weapname $weapindex (+ $weapindex $weapcount)) ]
                    guilist [
                        guibutton "^fo<prev" [weapindexdelta -1]
                        guistrut 1
                        guibutton "^fynext>" [weapindexdelta 1]
                    ]
                ]
            ]
            guistrut 1
            guifont "little" [
                guilist [
                    guilist [
                        vardef (format "%1name" $weapname) "name"
                        varhdef (format "%1colour" $weapname) "colour"
                        varhdef2 (format "%1partcol" $weapname) "partcol"
                        varhdef2 (format "%1explcol" $weapname) "explcol"
                        vardef (format "%1add" $weapname) "add"
                        vardef (format "%1max" $weapname) "max"
                        vardef2 (format "%1sub" $weapname) "reduced"
                        vardef2 (format "%1adelay" $weapname) "adelay"
                        vardef (format "%1rdelay" $weapname) "rdelay"
                        vardef2 (format "%1damage" $weapname) "damage"
                        vardef2 (format "%1speed" $weapname) "speed"
                        vardef2 (format "%1power" $weapname) "power"
                        vardef2 (format "%1time" $weapname) "time"
                        vardef2 (format "%1pdelay" $weapname) "pdelay"
                        vardef2 (format "%1gdelay" $weapname) "gdelay"
                        vardef2 (format "%1edelay" $weapname) "edelay"
                        vardef2 (format "%1explode" $weapname) "explode"
                    ]
                    guistrut 2
                    guilist [
                        varfld (format "%1name" $weapname) 16
                        varfld (format "%1colour" $weapname) 16
                        varfld2 (format "%1partcol" $weapname) 7
                        varfld2 (format "%1explcol" $weapname) 7
                        varfld (format "%1add" $weapname) 16
                        varfld (format "%1max" $weapname) 16
                        varfld2 (format "%1sub" $weapname) 7
                        varfld2 (format "%1adelay" $weapname) 7
                        varfld (format "%1rdelay" $weapname) 16
                        varfld2 (format "%1damage" $weapname) 7
                        varfld2 (format "%1speed" $weapname) 7
                        varfld2 (format "%1power" $weapname) 7
                        varfld2 (format "%1time" $weapname) 7
                        varfld2 (format "%1pdelay" $weapname) 7
                        varfld2 (format "%1gdelay" $weapname) 7
                        varfld2 (format "%1edelay" $weapname) 7
                        varfld2 (format "%1explode" $weapname) 7
                   ]
                ]
            ]
        ]
        guistrut 2
        guifont "little" [
            guilist [
                guilist [
                    guilist [
                        vardef2 (format "%1rays" $weapname) "rays"
                        vardef2 (format "%1spread" $weapname) "spread"
                        vardef2 (format "%1zdiv" $weapname) "zdiv"
                        vardef2 (format "%1aiskew" $weapname) "aiskew"
                        vardef2 (format "%1flakweap" $weapname) "flakweap"
                        vardef2 (format "%1flakdmg" $weapname) "flakdmg"
                        vardef2 (format "%1flakrays" $weapname) "flakrays"
                        vardef2 (format "%1flaktime" $weapname) "flaktime"
                        vardef2 (format "%1flakspeed" $weapname) "flakspeed"
                        vardef2 (format "%1cooked" $weapname) "cooked"
                        vardef2 (format "%1guided" $weapname) "guided"
                        vardef2 (format "%1extinguish" $weapname) "extinguish"
                        vardef2 (format "%1radial" $weapname) "radial"
                        vardef2 (format "%1residual" $weapname) "residual"
                        vardef (format "%1reloads" $weapname) "reloads"
                        vardef (format "%1carried" $weapname) "carried"
                        vardef (format "%1zooms" $weapname) "zooms"
                        vardef2 (format "%1fullauto" $weapname) "fullauto"
                        vardef (format "%1allowed" $weapname) "allowed"
                        vardef2 (format "%1critdash" $weapname) "critdash"
                        vardef2 (format "%1taperin" $weapname) "taperin"
                        vardef2 (format "%1taperout" $weapname) "taperout"
                        vardef2 (format "%1elasticity" $weapname) "elasticity"
                        vardef2 (format "%1reflectivity" $weapname) "reflectivity"
                        vardef2 (format "%1relativity" $weapname) "relativity"
                    ]
                    guistrut 2
                    guilist [
                        varfld2 (format "%1rays" $weapname) 7
                        varfld2 (format "%1spread" $weapname) 7
                        varfld2 (format "%1zdiv" $weapname) 7
                        varfld2 (format "%1aiskew" $weapname) 7
                        varfld2 (format "%1flakweap" $weapname) 7
                        varfld2 (format "%1flakdmg" $weapname) 7
                        varfld2 (format "%1flakrays" $weapname) 7
                        varfld2 (format "%1flaktime" $weapname) 7
                        varfld2 (format "%1flakspeed" $weapname) 7
                        varfld2 (format "%1cooked" $weapname) 7
                        varfld2 (format "%1guided" $weapname) 7
                        varfld2 (format "%1extinguish" $weapname) 7
                        varfld2 (format "%1radial" $weapname) 7
                        varfld2 (format "%1residual" $weapname) 7
                        varfld (format "%1reloads" $weapname) 16
                        varfld (format "%1carried" $weapname) 16
                        varfld (format "%1zooms" $weapname) 16
                        varfld2 (format "%1fullauto" $weapname) 7
                        varfld (format "%1allowed" $weapname) 16
                        varfld2 (format "%1critdash" $weapname) 7
                        varfld2 (format "%1taperin" $weapname) 7
                        varfld2 (format "%1taperout" $weapname) 7
                        varfld2 (format "%1elasticity" $weapname) 7
                        varfld2 (format "%1reflectivity" $weapname) 7
                        varfld2 (format "%1relativity" $weapname) 7
                    ]
                ]
            ]
            guistrut 3
            guilist [
                guilist [
                    guilist [
                        vardef2 (format "%1waterfric" $weapname) "waterfric"
                        vardef2 (format "%1weight" $weapname) "weight"
                        vardef2 (format "%1radius" $weapname) "radius"
                        vardef2 (format "%1kickpush" $weapname) "kickpush"
                        vardef2 (format "%1hitpush" $weapname) "hitpush"
                        vardef2 (format "%1slow" $weapname) "slow"
                        vardef2 (format "%1aidist" $weapname) "aidist"
                        vardef2 (format "%1partsize" $weapname) "partsize"
                        vardef2 (format "%1partlen" $weapname) "partlen"
                        vardef (format "%1frequency" $weapname) "frequency"
                        vardef (format "%1pusharea" $weapname) "pusharea"
                        vardef (format "%1critmult" $weapname) "critmult"
                        vardef (format "%1critdist" $weapname) "critdist"
                        vardef2 (format "%1delta" $weapname) "delta"
                        vardef2 (format "%1trace" $weapname) "trace"
                        vardef2 (format "%1headmin" $weapname) "headmin"
                        vardef2 (format "%1whipdmg" $weapname) "whipdmg"
                        vardef2 (format "%1torsodmg" $weapname) "torsodmg"
                        vardef2 (format "%1legsdmg" $weapname) "legsdmg"
                        vardef2 (format "%1flakscale" $weapname) "flakscale"
                        vardef2 (format "%1flakspread" $weapname) "flakspread"
                        vardef2 (format "%1flakrel" $weapname) "flakrel"
                        vardef2 (format "%1flakffwd" $weapname) "flakffwd"
                        vardef2 (format "%1flakoffset" $weapname) "flakoffset"
                        vardef2 (format "%1flakskew" $weapname) "flakskew"
                    ]
                    guistrut 2
                    guilist [
                        varfld2 (format "%1waterfric" $weapname) 7
                        varfld2 (format "%1weight" $weapname) 7
                        varfld2 (format "%1radius" $weapname) 7
                        varfld2 (format "%1kickpush" $weapname) 7
                        varfld2 (format "%1hitpush" $weapname) 7
                        varfld2 (format "%1slow" $weapname) 7
                        varfld2 (format "%1aidist" $weapname) 7
                        varfld2 (format "%1partsize" $weapname) 7
                        varfld2 (format "%1partlen" $weapname) 7
                        varfld (format "%1frequency" $weapname) 16
                        varfld (format "%1pusharea" $weapname) 16
                        varfld (format "%1critmult" $weapname) 16
                        varfld (format "%1critdist" $weapname) 16
                        varfld2 (format "%1delta" $weapname) 7
                        varfld2 (format "%1trace" $weapname) 7
                        varfld2 (format "%1headmin" $weapname) 7
                        varfld2 (format "%1whipdmg" $weapname) 7
                        varfld2 (format "%1torsodmg" $weapname) 7
                        varfld2 (format "%1legsdmg" $weapname) 7
                        varfld2 (format "%1flakscale" $weapname) 7
                        varfld2 (format "%1flakspread" $weapname) 7
                        varfld2 (format "%1flakrel" $weapname) 7
                        varfld2 (format "%1flakffwd" $weapname) 7
                        varfld2 (format "%1flakoffset" $weapname) 7
                        varfld2 (format "%1flakskew" $weapname) 7
                    ]
                ]
            ]
            guistrut 3
            guilist [
                vardef2 (format "%1collide" $weapname) "^fwcollision:       ^fwpri^fa/^fwalt"
                guilist [
                    guilist [
                        guitext "impact geom"
                        guitext "bounce geom
                        guitext "impact ppl"
                        guitext "bounce ppl"
                        guitext "impact shot"
                        guitext "traced"
                        guitext "hit owner"
                        guitext "continue"
                        guitext "sticky"
                        guitext "destroy"
                     ]
                     guistrut 2
                     guilist [
                        varbit2 (format "%1collide" $weapname) 1
                        varbit2 (format "%1collide" $weapname) 2
                        varbit2 (format "%1collide" $weapname) 4
                        varbit2 (format "%1collide" $weapname) 8
                        varbit2 (format "%1collide" $weapname) 16
                        varbit2 (format "%1collide" $weapname) 32
                        varbit2 (format "%1collide" $weapname) 64
                        varbit2 (format "%1collide" $weapname) 128
                        varbit2 (format "%1collide" $weapname) 256
                        varbit2 (format "%1collide" $weapname) 512
                    ]
                ]
                guistrut 1
                vardef2 (format "%1flakcollide" $weapname) "^fwflak collision:  ^fwpri^fa/^fwalt"
                guilist [
                    guilist [
                        guitext "impact geom"
                        guitext "bounce geom
                        guitext "impact ppl"
                        guitext "bounce ppl"
                        guitext "impact shot"
                        guitext "traced"
                        guitext "hit owner"
                        guitext "continue"
                        guitext "sticky"
                        guitext "destroy"
                     ]
                     guistrut 2
                     guilist [
                        varbit2 (format "%1flakcollide" $weapname) 1
                        varbit2 (format "%1flakcollide" $weapname) 2
                        varbit2 (format "%1flakcollide" $weapname) 4
                        varbit2 (format "%1flakcollide" $weapname) 8
                        varbit2 (format "%1flakcollide" $weapname) 16
                        varbit2 (format "%1flakcollide" $weapname) 32
                        varbit2 (format "%1flakcollide" $weapname) 64
                        varbit2 (format "%1flakcollide" $weapname) 128
                        varbit2 (format "%1flakcollide" $weapname) 256
                        varbit2 (format "%1flakcollide" $weapname) 512
                    ]
                ]
            ]
        ]
    ]
]

newgui vars [
    guilist [ varsmenu ]
    guitab "weap"
    guilist [ weapmenu ]
] [
    if (= $guipasses 0) [
        weapmenuinit
    ]
]

sinfoindex = 0
sinfowait = 0
sinforetry = ""
sinfopass = ""
sinfonum = 0
sinfodisp = 0

servermenuinit = [
    sinfoindex = 0
    sinfowait = 0
    sinforetry = ""
    sinfopass = ""
    shownservergui = 0
]
servermenuiter = [
    if (!= $shownservergui 1) [
        maplist = ""
        mappath = ""
        loopfiles lcurmap maps mpz [
            if (< (listfind mcurmap $maplist [strcmp $mcurmap $lcurmap]) 0) [
                maplist = (concat $maplist $lcurmap)
                mappath = (concat $mappath (concatword "maps/" $lcurmap))
            ]
        ]
        if (> $hasoctapaks 0) [
            loopfiles lcurmap base ogz [
                maplist = (concat $maplist $lcurmap)
                mappath = (concat $mappath (concatword "base/" $lcurmap))
            ]
        ]
        shownservergui = 1
    ]
]
servermenu = [
    guipage sinfo 6 88 4.2 [> (updateservers) 0] (getserver 0) [sinfovalue = (getserver (+ $i 1))] [< (at $sinfovalue 0) 4] [guibutton "^fwThere are no servers to display, try ^fgupdating ^fwthe list" updatefrommaster [] "info"] [
        guilist [
            guibutton "^fgupdate"                       updatefrommaster;   guistrut 1.5
            guibutton "^frreset"                        clearservers;       guistrut 1.5
            guibutton "^fodisconnect"                   disconnect;         guistrut 1.5
            guibutton "^fmlan connect"                  lanconnect;         guistrut 1.5
            guicheckbox "^fcsearch lan"                 searchlan;          guistrut 1.5
            guicheckbox "^fbauto sort"                  autosortservers;    guistrut 1.5
            guibutton "^fysort"                         sortservers;        guistrut 1.5
            guispring
            guitext (format "^fd[ ^fc%1 ^fwof ^fc%2 ^fw%3 ^fd]" $sinfodisp $sinfonum (? (= $sinfonum 1) "server" "servers"))
            guistrut 3.5
        ]
        if (> (getversion 3) (getversion 1)) [
            guilist [ guibutton "^fzoynew version released! ^fwget it now from: ^fcwww.redeclipse.net" "" ]
        ]
    ] [
        sinfoattrs = (getserver (+ $i 1) 1)
        sinfostat = (at $sinfovalue 0)
        sinfoname = (at $sinfovalue 1)
        sinfoport = (at $sinfovalue 2)
        sinfonpid = (format "%1:[%2]" $sinfoname $sinfoport)
        sinfodesc = (at $sinfovalue 3)
        sinfomapn = (at $sinfovalue 4)
        sinfonump = (at $sinfovalue 5)
        sinfoping = (at $sinfovalue 6)
        sinfogver = (at $sinfoattrs 0)
        sinfomode = (at $sinfoattrs 1)
        sinfomuts = (at $sinfoattrs 2)
        sinfotime = (at $sinfoattrs 3)
        sinfomaxp = (at $sinfoattrs 4)
        sinfomstr = (at $sinfoattrs 5)
        sinfovars = (at $sinfoattrs 6)
        sinfomods = (at $sinfoattrs 7)
        guistrut 0.125
        guimerge 88 [
            guilist [
                guistrut 1
                guilist [ guistrut 8 ]
                if (< $sinfoping $serverwaiting) [
                    guilist [
                        guifont "emphasis" [ guibutton (format "^fw%1" $sinfonump) ]
                        guifont "little" [ guibutton (format "^fd / ^fa%1" $sinfomaxp) ]
                    ]
                    guistrut 0.25
                    guilist [
                        guifont "reduced" [ guibutton (format (if (< $sinfoping 200) [result "^fg%1"] [if (< $sinfoping 400) [result "^fy%1"] [result "^fr%1"]]) $sinfoping) ]
                        guifont "little" [ guibutton " ^fams" ]
                    ]
                ] [
                    guifont "super" [ guibutton "?" ]
                ]
            ]
            sinfoimage = "textures/emblem"
            if (&& (< $sinfoping $serverwaiting) (= $sinfogver (getversion 1))) [
                sinfopath = (listfind curmap $maplist [(|| (strcmp $curmap $sinfomapn) (strcmp (concatword "maps/" $curmap) $sinfomapn) (&& (> $hasoctapaks 0) (strcmp (concatword "base/" $curmap) $sinfomapn)))])
                if (> $sinfopath -1) [ sinfoimage = (at $mappath $sinfopath) ]
            ]
            guiimage (format "%1" $sinfoimage) "" 2 1 "textures/emblem"
            guistrut 1
            guilist [
                guistrut 0.5
                guilist [
                    guifont "reduced" [ guibutton (format "^fw%1" $sinfodesc) ]
                    guifont "little" [
                        guibutton (format " ^fd(^fa%1^fd)" $sinfonpid)
                        if (> $sinfomods 0) [
                            guibutton (format " ^fc%1%% modified" (round (*f (divf $sinfomods $sinfovars) 100) 2))
                        ] [ guibutton " ^fgunmodified" ]
                    ]
                ]
                if (< $sinfoping $serverwaiting) [
                    guilist [
                        guistrut 0.25
                        if (= $sinfogver (getversion 1)) [
                            guifont "default" [
                                case $sinfostat 0 [
                                    guibutton "^fgopen" [] [] "textures/server"
                                ] 1 [
                                    guibutton "^fylock" [] [] "textures/serverlock"
                                ] 2 [
                                    guibutton "^fmpriv" [] [] "textures/serverpriv"
                                ] 3 [
                                    guibutton "^frfull" [] [] "textures/serverfull"
                                ] () [
                                    guibutton "^founknown" [] [] "textures/serverunk"
                                ]
                            ]
                            guifont "reduced" [ guibutton (format " ^fd[^fw%1^fd]" (timetostr $sinfotime 2)) ]
                            gname = (gamename $sinfomode $sinfomuts)
                            if (> (strlen $gname) 32) [ gname = (gamename $sinfomode $sinfomuts 1) ]
                            guifont "little" [ guibutton (format " ^fy%1 ^faon ^fo%2" $gname $sinfomapn) ]
                        ] [
                            guifont "default" [ guibutton "^foincompatible" [] [] "textures/serverfail" ]
                            guifont "reduced" [ guibutton (format " ^faserver is using %1 protocol" (? (> $sinfogver (getversion 1)) "a ^fwnewer" "an ^fdolder")) ]
                        ]
                    ]
                    guilist [
                        if (strcmp $sinfonpid $sinforetry) [
                            if (= $sinfostat 3) [ guibutton "^fd[ ^fwwaiting for slot ^fd] " ]
                            guibutton "^fwpassword ^fd= "
                            sinfopassval = $sinfopass
                            guifield sinfopassval 20 [sinfopass = $sinfopassval]
                        ] [
                            if (> $sinfonump 0) [
                                guistrut 0.25
                                sinfoplayers = (getserver (+ $i 1) 2)
                                sinfopnum = (listlen $sinfoplayers)
                                if (> $sinfopnum 0) [
                                    guifont "reduced" [ guibutton (format "^fc%1 ^fw%2:" $sinfopnum (? (= $sinfopnum 1) "player" "players")) ]
                                    pname = ""
                                    pmore = 0
                                    loop j $sinfopnum [
                                        if (> (strlen $pname) 86) [ pmore = (+ $pmore 1) ] [
                                            if (= $j 0) [ guibutton " " ] [
                                                if (= $j (- $sinfopnum 1)) [
                                                    pname = (format "%1 ^faand " $pname)
                                                ] [ pname = (format "%1^fa, " $pname) ]
                                            ]
                                            pname = (format "%1%2" $pname (at $sinfoplayers $j))
                                        ]
                                    ]
                                    if (> $pmore 0) [ pname = (format "%1 ^faand ^fy%2 ^famore" $pname $pmore) ]
                                    guifont "little" [ guibutton $pname ]
                                ] [ guifont "reduced" [ guibutton "^faplayer info not available" ] ]
                            ] [ guifont "reduced" [ guibutton "^fano players online" ] ]
                        ]
                    ]
                ] [
                    guilist [
                        guistrut 0.25
                        guifont "default" [ guibutton "^founresponsive" [] [] "textures/serverfail" ]
                        guifont "reduced" [ guibutton " ^faserver is not replying to queries" ]
                    ]
                ]
            ]
        ] [
            sinfopass = ""
            sinforetry = @sinfonpid
            if (|| (hasauthkey) (!= @sinfomstr 4)) [ sinfowait = 0 ] [ sinfowait = 1 ] 
        ] [
            sinfopass = ""
            sinforetry = @sinfonpid
            if (hasauthkey) [ sinfowait = 0 ] [ sinfowait = 1 ] 
        ]
        if (strcmp $sinfonpid $sinforetry) [
            if (= $sinfowait 1) [
                if (> (strlen $sinfopass) 0) [ connect $sinfoname $sinfoport $sinfopass; sinfopass = ""; sinforetry = ""; sinfowait = 0 ]
            ] [
                if (|| (hasauthkey) (!= $sinfostat 3)) [ connect $sinfoname $sinfoport; sinfopass = ""; sinforetry = ""; sinfowait = 0 ]
            ]
        ]
        guistrut 0.125
    ] [
        guicomb [
            guistrut 0.25
            guilist [
                guifont "little" [ guitext "update interval:" ]
                guistrut 2
                guilist [
                    guilist [ guistrut 77 ]
                    guilistslider serverupdateinterval "1 2 3 4 5 10 15 20 25 30 35 40 45 50 55 60"
                ]
            ]
        ]
    ]
]

newgui servers [
    servermenuiter
    guilist [ servermenu ]
] [
    if (= $guipasses 0) [
        servermenuinit
    ]
]

showfileeditor = [
    guinoautotab [
        guieditor $arg1 $arg2 $arg3
        textinit $arg1 $arg1
        guistayopen [
            guilist [
                guibutton "load" [textfocus @arg1; textload @arg1]
                guibar
                guibutton "save" [textfocus @arg1; textsave @arg1]
                guibar
                guibutton "exec" [textfocus @arg1; textexec]
                guibar
                guibutton "copy" [textfocus @arg1; textcopy]
                guibar
                guibutton "paste" [textfocus @arg1; textpaste]
                guibar
                guibutton "select" [textfocus @arg1; textselectall]
                guibar
                guibutton "clear" [textfocus @arg1; textclear]
            ]
        ]
    ]
]

notepadfile = "untitled.txt"

newgui notepad [
    guifield notepadfile -30
    showfileeditor $notepadfile -80 20
]

notepad = [
    if (> $numargs 0) [notepadfile = $arg1]
    showgui notepad
]

newgui pastebuffer [
    guinoautotab [
        guieditor "#pastebuffer" -80 20
        guistayopen [
            guilist [
                guibutton "exec" [textfocus "#pastebuffer"; textexec]
                guibar
                guibutton "clear" [textfocus "#pastebuffer"; textclear]
            ]
        ]
    ]
]

pastebuffer = [showgui pastebuffer]

newgui scratchpad [
    guinoautotab [
        guieditor "#scratchpad" -80 20
        guistayopen [
            guilist [
                guibutton "exec" [textfocus "#scratchpad"; textexec]
                guibar
                guibutton "copy" [textfocus "#scratchpad"; textcopy]
                guibar
                guibutton "paste" [textfocus "#scratchpad"; textpaste]
                guibar
                guibutton "select" [textfocus "#scratchpad"; textselectall]
                guibar
                guibutton "clear" [textfocus "#scratchpad"; textclear]
            ]
        ]
    ]
]

scratchpad = [showgui scratchpad]

doinsel = 0

findents = [
    match = 1
    if $doinsel [
        if (= $doinsel 1) [
            match = (* $match (insel))
        ] [
            match = (* $match (! (insel)))
        ]
    ]
    if $dosearch0 [
        match = (* $match (strcmp (et) (at $enttypelist $entt)))
    ]
    loop i 5 [
        if (getalias (concatword "dosearch" (+ $i 1))) [
            match = (* $match (= (ea (+ $i 1)) (getalias (concatword "enta" (+ $i 1)))))
        ]
    ]

    result $match
]

entt = 0
enta1 = 0
enta2 = 0
enta3 = 0
enta4 = 0
enta5 = 0

dosearch0 = 1
dosearch1 = 1
dosearch2 = 1
dosearch3 = 1
dosearch4 = 1
dosearch5 = 1

newgui entfind [
    guitext "Set the attributes below to search for"
    guistrut 1
    guicheckbox "Type (see next tab)" dosearch0
    loop i 5 [
        guilist [
            guicheckbox [attr @(+ $i 1)] [dosearch@(+ $i 1)]
            guistrut 1
            guifield [enta@(+ $i 1)] 11 [ enta@(+ $i 1) = (min 0x7FFFFFFF (max -0x7FFFFFFF $enta@(+ $i 1)))]
        ]
    ]

    guilist [
        guiradio "off" doinsel 0
        guistrut 1
        guiradio "inside selection" doinsel 1
        guistrut 1
        guiradio "outside selection" doinsel 2
    ]

    guibar
    guistayopen [
        guibutton "Copy Attributes from currently selected entity" [
            loop i 5 [
                [enta@(+ $i 1)] = (ea (+ $i 1))
            ]
            loop i (listlen $enttypelist) [
                if (strcmp (et) (at $enttypelist $i)) [
                    entt = $i
                ]
            ]
        ]
        guibutton "select all valid entities" [entselect [(findents)]]
    ]

    guitab Type
    guilist [
        loop i (+ (div (listlen $enttypelist) 10) 1) [
            guilist [
                loop j (min (- (listlen $enttypelist) (* 10 $i)) 10) [
                    guiradio (at $enttypelist (+ $j (* $i 10))) entt (+ $j (* $i 10))
                ]
            ]
        ]
    ]
]

newmapsize = 12
savemap_name = temp

newgui editing [
	guilist [
		guilist [
		guibutton	"toggle walk / edit mode"				"edittoggle"	
		guitext
		guibutton	"open textures menu.."					"showtexgui"
		guibutton	"open this edit menu.."					" "
		guibutton	"open materials menu.."					"showgui materials"
		guibutton	"open console.."						"saycommand /"
		guitext
		guibutton 	"optimize geometry"						"remip"
		guibutton	"patch existing lightmap (patch)"		[fullbright 0; patchlight]
		guibutton	"quick calculate lights (preview)"		[fullbright 0; calclight -1]
		guibutton 	"full calculate lights (full)"			[fullbright 0; calclight 1]
		guitext
		guibutton	"environment settings.."				"showgui environment"
		guitext
		guibutton	"claim master.."						"showgui servermaster"
		guitext
		guibutton 	"send map to server"					"sendmap"
		guibutton	"get map from server"					"getmap"
		guitext
		guibutton	"take screenshot"						[ cleargui; sleep 0 [ screenshot ] ]
		
		];
		
		
	guilist [
		guitext	"				key F1"
		guitext
		guitext	"				key F2"
		guitext	"				key F3"
		guitext	"				key Numpad 0"
		guitext "				key ~ or /"
		guitext
		guitext	"				key F4"
		guitext	"				key F5"
		guitext	"				key F6"
		guitext	"				key F7"
		guitext
		guitext
		guitext
		guitext					
		guitext
		guitext	"				key Insert"
		guitext "				key Delete"
		guitext
		guitext	"				key F12"
		]
	]



	guitab file
		guilist [
			guilist [
			guitext
			guitext 	"set map title.."
			guifield 												maptitle 40 [ maptitle $maptitle ]
			guitext 	"set map author.."
			guifield  												mapauthor 40 [ mapauthor $mapauthor ]
			guitext 	"set map filename"				
			guifield  												savemap_name 40 [ savemap $savemap_name ]
			guitext
			guibutton	"^foSAVE ^fwmap as filename"				"savemap"
			guitext
			guibutton 	"increase mapsize (2x)"              		"mapenlarge"
			guitext
			guibutton	"start new map"								"showgui newmapgui"
			];
			
			guilist [

			guitext	
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext					"key F8"
			guitext        				
			guitext
			guitext
			guitext
			]
		]

    guitab ents
		guilist [
			guilist [
			guibutton	"find ents"				"showgui entfind"
			guitext
			guibutton	"link selected ents (teleport, sound, trigger)"	"showgui entlink"
			guitext
			guibutton	"focus on selected ent"									"entautoview"
			guibutton	"deselect all ents"										"entcancel"
			guibutton	"edit selected ent"										"selentedit"
			guitext	
			guibutton	"select all ents inside selection area"					"entselect insel"
			guibutton	"select all ents matching selected"						"selentfindall"
			guitext	
			guitext	
			guibutton	"create weapon.."										"showgui createweapon"
			guibutton	"create playerstart"									"saycommand [/newent playerstart 0 0 0 0 0]"
			guibutton	"create light.."										"resetlight;showgui newlight"
			guibutton	"create teleport.."										"showgui newteleport"
			guibutton	"create mapmodel"										"saycommand [/newent mapmodel 0 0 0 0 0]"
			guibutton	"create sound"											"saycommand [/newent sound 0 0 0 0 0]"		
			guibutton	"create pusher"											"saycommand [/newent pusher 0 90 200 0 0 0]"
			guibutton	"create affinity (flag)"								"saycommand [/newent affinity 0 0 0 0 0]"
			guibutton	"create actor"											"saycommand [/newent actor 0 0 0 0 0 0 0 0 0]"
			guibutton	"create trigger"										"saycommand [/newent trigger 0 0 0 0 0 0 ]"
			];
			
			guilist [
			guitext
			guitext
			guitext "			key L cycles link modes"
			guitext
			guitext "			key Comma (,) + scroll"
			guitext "			key End"
			guitext	"			key Period (.)"
			guitext
			guitext	"			key N"
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext
			guitext 
			]
		]
		
		



    

    guitab ops
		guilist [
			guilist [
			guibutton	"copy"												"copy"
			guibutton	"paste"												"paste"
			guitext
			guibutton	"mirror geometry per selection orientation"			"flip"
			guibutton	"delete selected ents / geometry"					"
			guibutton	"grab texture from selected face"					"gettex"
			guibutton	"repeat last texture change across entire map"		[allfaces 0; replace]
			guitext
			guibutton	"toggle heightmap mode"								"hmapedit 1"
			guitext
			guibutton	"materials.."										[showgui materials]
			guitext
			guibutton	"waypoints.."										[showgui waypoints]
			guitext
			guibutton	"undo"												"undo"
			guibutton	"redo"												"redo"
			guitext		"undo cache size (default: 5 MB)"
			guislider														"undomegs" 1 10
			];
		
			guilist [
			guitext	"	key C"
			guitext	"	key V"
			guitext
			guitext	"	key X"
			guitext	"	key Backspace"
			guitext	"	key J"
			guitext
			guitext
			guitext	"	key H, key Alt exit"
			guitext
			guitext	"	key Numpad 0"
			guitext
			guitext
			guitext
			guitext	"	key Z"
			guitext	"	key I"
			guitext
			guitext
			]
		]


	guitab vtex
	guilist [
		guilist [
		guitext "create new version of the selected face texture:"
		guitext ""
		guibutton "color.."													"showgui vcolor"
		guitext
		guibutton "scale.."													"showgui vscale"
		guibutton "rotate / flip.."											"showgui vrotate"
		guibutton "offset texture up or down.."								"showgui voffset"
		guitext
		guibutton "texture scrolling.."										"showgui vscroll"
		guitext
		guibutton "glow color.."											"showgui glowcolor"
		guibutton "specularitiy (gloss).."									"showgui specscale"
		guibutton "hightmap intensity.."									"showgui parallaxscale"
		guitext
		guibutton "texture blend painting.."								"showgui blendmap"
		guitext
		guibutton "^foRESET ^fwselected textures to default"				"vreset"
		guitext
		guibutton "^foRESET ^fwall textures in map"							"showgui texreset"
		]
	]
	
	guitab helpers
		guilist [
			guilist [
			guicheckbox	"toggle edit radar"						[showeditradar]
			guicheckbox	"show material volumes"					"showmat"
			guitext			
			guicheckbox	"toggle fullbright"						"fullbright"
			guicheckbox	"toggle wireframe"						"wireframe"
			guicheckbox	"toggle blank geometry"					"blankgeom"
			guicheckbox	"toggle outline"						"outline"
			guibutton	"set outline color.."					"showgui outlinecolor"
			guitext				
			guicheckbox	"toggle paste grid"						"showpastegrid"
			guicheckbox	"toggle cursor grid"					"showcursorgrid"
			guicheckbox	"toggle selection grid"					"showselgrid"
			guicheckbox	"snap ents to grid"						"entselsnap"
			guitext				
			guicheckbox	"toggle allfaces texture mode"			"allfaces"
			guitext
			guitext 	"adjust your float speed (0-1000)"
			guifield  											floatspeed 10 [ floatspeed $floatspeed ]
		];
	
		guilist [
			guitext	"					toggle edit radar"
			guitext	"					key M"
			guitext
			guitext	"					tkey B"
			guitext
			guitext	"					key k"
			guitext	"					key O, F9"
			guitext
			guitext
			guitext	"					key Tab"
			guitext	"					key Tab"
			guitext	"					key Tab"
			guitext				
			guitext
			guitext "					key 0"
		]
	]


    guitab lightmap
		guilist [
			guilist [
	
		guitext "lightprecision (default: 32)"
		guilistslider lightprecision "8 16 32 48 64 128 256"
		guitext "lighterror (default: 8)"
		guislider lighterror
		guitext "lightthreads (CPU threads/cores) (default: 1)"
		guislider lightthreads
		guitext
		guibutton "set min light level / shadow color (ambient)..."               	"showgui environment 2"
		guitext
		guibutton "optimize geometry"												"remip"
		guibutton "patch existing lightmap (patch)"									[fullbright 0; patchlight]
		guibutton "quick calculate lights (preview)"								[fullbright 0; calclight -1]
		guibutton "full calculate lights (full)"									[fullbright 0; calclight 1]
		];
		
		guilist [
		guitext
		guitext
		guitext
		guitext 
		guitext 
		guitext
		guitext
		guitext
		guitext 
		guitext
		guitext "		key F4"
		guitext "		key F5"
		guitext "		key F6"
		guitext "		key F7"
		]
	]

	
	guitab keyref
	guilist [ 
		guilist [ 
		guitext "change gridsize"
		guitext "select"
		guitext "extend selection / select additional ents"
		guitext	"move selection area / move selected ents"
		guitext	"deselect all"
		guitext	"orient selection face"
		guitext	"create /destroy cubes"
		guitext	"push / pull selected faces"
		guitext	"push / pull corner"
		guitext "select multiple corners"
		guitext	"move selected geometry"
		guitext	"copy"
		guitext	"paste"
		guitext	"rotate geometry per selection orientation"
		guitext	"mirror geometry per selection orientation"
		guitext	"quick texture selected faces"
		guitext	"grab texture from selected faces"
		guitext "change properties of selected ents"
		guitext	"cycle link modes for selected ents"
		];
	
	
		guilist [ 
		guitext "	hold key G + scroll wheel" 
		guitext "	drag left mouse button" 
		guitext "	right mouse button" 
		guitext "	right mouse button" 
		guitext "	key Space"
		guitext "	right mouse button"
		guitext "	scroll mouse wheel"
		guitext "	hold key F + scroll mouse wheel"
		guitext "	hold key Q + scroll wheel"
		guitext "	drag middle mouse button"
		guitext "	hold key U + drag right mouse button"
		guitext "	key C"
		guitext "	key V"
		guitext "	hold key R + scroll mouse wheel"
		guitext "	key X"
		guitext "	hold key Y + scroll mouse wheel"
		guitext "	key J"
		guitext "	hold number keys 1-9 + scroll mouse wheel"
		guitext	"	key L"
		]
	]
	
			


	guitab cfg
    guitext (format "%1.cfg" $mapname)
    showfileeditor (format "%1.cfg" $mapname) -80 20
]









newgui servermaster [
	guistayopen [
		guiradio	"veto server"					openservertype 0	[serveropen 3]
		guiradio	"open server"					openservertype 1	[serveropen 1]
		guiradio	"coop server"					openservertype 2	[serveropen 2]
		guitext
		guibutton	"claim master"					"setmaster 1"
		guibutton	"relinquish master"				"setmaster 0"
		guitext
		guibutton	"admin password"				"saycommand [/adminpass ]"
	]
]

newgui waypoints [
		guicheckbox	"show waypoints"							"showwaypoints"
		guicheckbox	"create waypoints"							"dropwaypoints"
		guiradio	"gamespeed 100% (default)"					gamespeedtype 0	[gamespeed 100]
		guiradio	"gamespeed 200% (faster waypointing)"		gamespeedtype 1	[gamespeed 200]
		guiradio	"gamespeed 75% (slower waypointing)"		gamespeedtype 2	[gamespeed 75]
		guitext
		guibutton	"add bot"									"addbot"
		guibutton	"remove bot"								"delbot"
		guitext 	"set minimum number of players in-game"
		guifield  											numplayers 10 [ numplayers $numplayers ]
		guitext
		guibutton	"^foSAVE ^fwwaypoints"						"savewaypoints"
		guibutton	"^foLOAD ^fwwaypoints"						"saycommand [/loadwaypoints ]"
		guibutton	"^foSAVE ^fwmap"							"savemap"
		guibutton	"^foCLEAR ^fwwaypoints in selection area"	"saycommand [/delselwaypoints]"
		guibutton	"^foCLEAR ^fwall waypoints"					"saycommand [/clearwaypoints]"
]
newgui createweapon [
		guilist [
			guilist [
			guitext	"^fo/newent weapon ^fy#"
			guibutton "sword"			"newent weapon 2"
			guibutton "shotgun"			"newent weapon 3"
			guibutton "smg"				"newent weapon 4"
			guibutton "flamer"			"newent weapon 5"
			guibutton "plasma"			"newent weapon 6"
			guibutton "rifle"			"newent weapon 7"
			guibutton "grenade"			"newent weapon 8"
			guibutton "rocket"			"newent weapon 9
			]
			guilist [
			guitext
			guitext "weapon 2"
			guitext "weapon 3"
			guitext "weapon 4"
			guitext "weapon 5"
			guitext "weapon 6"
			guitext "weapon 7"
			guitext "weapon 8"
			guitext "weapon 9"
			]
		]
]



newgui newmapgui [
		guibutton 	"^foREVERT ^fwto last saved version of @savemap_name"   	"map $savemap_name"
		guitext
		guibutton	"^foOPEN ^fwan existing map"								"showgui maps 1"
		guitext
		guibutton 	"^foCLEAR MAP ^fwand begin a new one ^fr(Warning!)"         "newmap $newmapsize"
		guitext		"size of new map"
		guislider 	"newmapsize" 10 16
]

newgui outlinecolor [
			guiradio	"white"					outlinetype 1 [outlinecolour 255 255 255]
			guiradio	"black"					outlinetype 2 [outlinecolour 0 0 0]
			guiradio	"blue"					outlinetype 3 [outlinecolour 80 80 255]
			guiradio	"red"					outlinetype 4 [outlinecolour 255 80 80]
			guiradio	"green"					outlinetype 5 [outlinecolour 80 255 80]
			guiradio	"yellow"				outlinetype 6 [outlinecolour 255 255 80]
			guitext
			guicheckbox	"toggle outline"		"outline"
]


newgui entlink [
	guistayopen [
	guitext "^fo/entlink ^fw cycles link modes of selected ents"
	guitext
	guibutton 	"cycle linkmode +			key L"					"entlink"
	guitext
	guitext 	"link modes:"
	guitext		"1. A     B
	guitext 	"2. ^frA >> B"
	guitext		"3. ^fyA <> B"
	guitext 	"4. ^frA << B"
	guitext
    guibutton	"create new teleport" 									"saycommand [/newent teleport -1 0 0 0 655 0]"
	guibutton	"create new sound"										"saycommand [/newent sound 0 0 0 0 0]"		
	guibutton	"create new trigger"									"saycommand [/newent trigger 0 0 0 0 0 0 0]"		
	]


]


newgui vcolor [
	guistayopen [
		guitext "^fo/vcolor ^fr%R ^fg%G ^fb%B"
		guitext
		guibutton "red"				"saycommand [/vcolor 1.0 0.3 0.3]"
		guibutton "green"			"saycommand [/vcolor 0.3 1.0 0.3]"
		guibutton "blue"			"saycommand [/vcolor 0.3 0.3 1.0]"
		guibutton "orange"			"saycommand [/vcolor 1.0 0.6 0.2]"
		guibutton "yellow"			"saycommand [/vcolor 1.0 0.8 0.3]"
		guibutton "purple"			"saycommand [/vcolor 0.5 0.2 0.7]"
		guibutton "turquoise"		"saycommand [/vcolor 0.1 0.8 0.8]"
		guibutton "dark"			"saycommand [/vcolor 0.3 0.3 0.3]"
		guibutton "white"			"saycommand [/vcolor 1.0 1.0 1.0]"
	]
]

newgui vscale [
	guistayopen [
    guitext "^fo/vscale ^fy% ^fw(0.125 - 8.0)"
	guitext
    guibutton "12.5%"		"saycommand [/vscale .125]"
	guibutton "25%"			"saycommand [/vscale .25]"
	guibutton "50%"			"saycommand [/vscale .5]"
	guibutton "75%"			"saycommand [/vscale .75]"
    guibutton "100%"		"saycommand [/vscale 1]"
    guibutton "150%"		"saycommand [/vscale 1.5]"
    guibutton "400%"		"saycommand [/vscale 4]"
	guibutton "800%"		"saycommand [/vscale 8]"
	]
]

newgui vrotate [ 
	guistayopen [
		guitext "^fo/vrotate ^fy# ^fy(1-3 rotate, 4-5 flip)"
		guitext
		guibutton "rotation/flip +"					"vdelta vrotate 1"
		guibutton "rotation/flip -"					"vdelta vrotate -1"
		guitext
		guibutton "rotate 90"						"saycommand [/vrotate 1]"
		guibutton "rotate 180"						"saycommand [/vrotate 2]"
		guibutton "rotate 270"						"saycommand [/vrotate 3]"
		guitext
		guibutton "flip vertical"					"saycommand [/vrotate 4]"
		guibutton "flip horizontal"					"saycommand [/vrotate 5]"
		guitext
		guibutton "^foRESET ^fwto 0"				"saycommand [/vrotate 0]"
	]
]

newgui specscale [
    guitext "^fo/vdelta vshaderparam specscale ^fr%R ^fg%G ^fb%B"
	guitext
    guibutton "red gloss"				"saycommand [/vdelta vshaderparam specscale 1.0 0.3 0.3]"
	guibutton "green gloss"				"saycommand [/vdelta vshaderparam specscale 0.3 1.0 0.3]"
	guibutton "blue gloss"				"saycommand [/vdelta vshaderparam specscale 0.3 0.3 1.0]"
	guibutton "orange gloss"			"saycommand [/vdelta vshaderparam specscale 1.0 0.6 0.2]"
    guibutton "yellow gloss"			"saycommand [/vdelta vshaderparam specscale 1.0 0.8 0.3]"
    guibutton "purple gloss"			"saycommand [/vdelta vshaderparam specscale 0.5 0.2 0.7]"
    guibutton "turquoise gloss			"saycommand [/vdelta vshaderparam specscale 0.1 0.8 0.8]"
	guibutton "50% gloss (subtle)"		"saycommand [/vdelta vshaderparam specscale 0.5 0.5 0.5]"
	guibutton "no gloss (matte)"		"saycommand [/vdelta vshaderparam specscale 0.0 0.0 0.0]"
	guitext
	guibutton "^foRESET ^fwto 100%"		"saycommand [/vdelta vshaderparam specscale 1.0 1.0 1.0]"
]

newgui glowcolor [

    guitext "^fo/vdelta vshaderparam glowcolor ^fr%R ^fg%G ^fb%B"
	guitext
    guibutton "red"						"saycommand [/vdelta vshaderparam glowcolor 1.0 0.3 0.3]"
	guibutton "green"					"saycommand [/vdelta vshaderparam glowcolor 0.3 1.0 0.3]"
	guibutton "blue"					"saycommand [/vdelta vshaderparam glowcolor 0.3 0.3 1.0]"
	guibutton "orange"					"saycommand [/vdelta vshaderparam glowcolor 1.0 0.6 0.2]"
    guibutton "yellow"					"saycommand [/vdelta vshaderparam glowcolor 1.0 0.8 0.3]"
    guibutton "purple"					"saycommand [/vdelta vshaderparam glowcolor 0.5 0.2 0.7]"
    guibutton "turquoise"				"saycommand [/vdelta vshaderparam glowcolor 0.1 0.8 0.8]"
	guitext
	guibutton "^foRESET ^fwto 100%"		"saycommand [/vdelta vshaderparam glowcolor 1.0 1.0 1.0]"
]

newgui parallaxscale [

    guitext "^fo/vdelta vshaderparam parallaxscale ^fr%R ^fg%G ^fb%B"
	guitext
    guibutton "flat"								"saycommand [/vdelta vshaderparam parallaxscale 0.0 0.0 0.0]"
	guibutton "extreme"								"saycommand [/vdelta vshaderparam parallaxscale 0.0025 0.0025 0.0025]"
	guibutton "another dimension"					"saycommand [/vdelta vshaderparam parallaxscale 1.0 1.0 1.0]"
	guitext
	guibutton "^foRESET ^fwto default"				"saycommand [/vdelta vshaderparam parallaxscale 0.0000025 0.0000025 0.0000025]"
]

newgui vscroll [
	guistayopen [
		guitext 	"^fo/vscroll ^fyX Y"
		guitext
		guibutton 	"scroll Y +"			"vdelta vscroll 0 +0.1"
		guibutton 	"scroll Y -"			"vdelta vscroll 0 -0.1"
		guitext
		guibutton 	"scroll X +"			"vdelta vscroll +0.1 0"
		guibutton 	"scroll X -"			"vdelta vscroll -0.1 0"
		guitext
		guibutton 	"^foRESET ^fwto 0"			"saycommand [/vscroll 0 0]"
	]
]
	
newgui voffset [
	guistayopen [
		guitext "^fo/vscroll ^fyXpx Ypx"
		guitext
		guibutton 	"offset Y +"			"vdelta voffset 0 +16"
		guibutton 	"offset Y -"			"vdelta voffset 0 -16"
		guitext
		guibutton 	"offset X +"			"vdelta voffset +16 0"
		guibutton 	"offset X -"			"vdelta voffset -16 0"
		guitext
		guibutton 	"^foRESET ^fwto 0"			"saycommand [/voffset 0 0]"
	]
]
	
newgui	blendmap [
	guilist [
		guilist [
		guitext	"^fo/vlayer ^fy# ^fw(texture slot number)"
		guitext
		guibutton	"show textures menu"	[ showtexgui ]
		guitext
		guibutton	"assign grass texture as paint"			"saycommand [/vlayer 563]"
		guibutton 	"assign mud texture as paint"			"saycommand [/vlayer 572]"
		guibutton	"assign snow texture as paint"			"saycommand [/vlayer 570]"
		guibutton	"assign sand texture as paint"			"saycommand [/vlayer 571]"
		guibutton	"assign concrete texture as paint"		"saycommand [/vlayer 13]"
		guibutton	"assign bricks texture as paint"		"saycommand [/vlayer 12]"
		guibutton	"^foREMOVE ^fwassigned texture as paint" [saycommand "/vlayer^"^""]
		guitext
		guibutton	"enable blend texture paint mode"		"blendpaintmode 2"
		guitext
		guitext
		guibutton	"^foCLEAR ^fwall blend painting "		"saycommand [/clearblendmap]"
		]
		guilist [
		guitext
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	
		guitext	"	key P cycle blend modes, 
		guitext "	mouse wheel change brush,
		guitext "	key Alt exit"
		]
	]
]

newgui texreset [
	guilist [
		guilist [
		guibutton "^foCLEAR ^fwall unused textures from map cfg"						"saycommand [/texturecull]"
		guibutton "^foCLEAR ^fwall textures from map cfg"								"saycommand [/texturereset]"
		guibutton "^foLOAD ^fwdefault texture package to map cfg (reload map required)"			"saycommand [/exec data/textures.cfg]"
		]
	]
]
newgui environment [ 
	guistayopen [
	guitext			"quick global lighting:"
	guitext
	guibutton		"night"										[ambient 40 40 40; skylight 70 80 90; skybox skyboxes/stars; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 50 60 100; cloudlayerblend 0.3; cloudscrollx 0.005; fogcolour 12 10 13; fog 2000; calclight -1]
	guibutton		"morning"									[ambient 60 35 40; skylight 170 140 145; skybox penguins/harmony; skycolour 255 160 180; cloudlayer skyboxes/clouds03; cloudlayercolour 255 125 170; cloudlayerblend 0.2; cloudscrollx 0.01; fogcolour 129 79 59; fog 2000; calclight -1]
	guibutton		"evening"									[ambient 50 30 10; skylight 180 100 70; skybox skyboxes/sunsetflat; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 255 100 50; cloudlayerblend 0.2; cloudscrollx 0.005; fogcolour 40 20 5; fog 2000; calclight -1]
	guitext
	guibutton		"^foRESET ^fwenvironment to default"		[ambient 0 0 0; skylight 0 0 0; skybox ""; skycolour 255 255 255; cloudlayer ""; cloudlayercolour 255 255 255; cloudlayerblend 1.0; cloudscrollx 0; fogcolour 128 153 179; fog 4000; calclight -1]
	
	guitab ambient
	guitext			"^fo/ambient ^frR ^fgG ^fbB"
	guibutton		"grey shadows"								"saycommand [/ambient 40 40 40]"
	guibutton		"purple shadows"							"saycommand [/ambient 60 35 40]"
	guibutton		"brown shadows"								"saycommand [/ambient 50 30 10]"
	guitext
	guibutton		"^foRESET ^fwambient to default"			"saycommand [/ambient 0 0 0]"
	
	guitab skylight
	guitext			"^fo/skylight ^frR ^fgG ^fbB"
	guibutton		"cool skylight"								"saycommand [/skylight 70 80 90]"
	guibutton		"soft skylight"								"saycommand [/skylight 170 140 145]"
	guibutton		"warm skylight"								"saycommand [/skylight 180 100 70]"
	guitext
	guibutton		"^foRESET ^fwskylight to default"			"saycommand [/skylight 0 0 0]"
	
	
	guitab fog 
		guitext 	"^fo/fog ^fy#"
		guibutton 	"fog distance far"				"saycommand [/fog 1500]"
		guibutton 	"fog distance distant"			"saycommand [/fog 800]"
		guibutton 	"fog distance near"				"saycommand [/fog 300]"
		guibutton 	"^foRESET ^fwfog distance"		"saycommand [/fog 4000]"
		guitext
		guitext
		guitext 	"^fo/fogcolour ^frR ^fgG ^fbB"
		guibutton 	"black fog (darkness)"				"saycommand [/fogcolour 0 0 0]"
		guibutton 	"grey fog (haze)"					"saycommand [/fogcolour 50 50 50]"
		guibutton 	"green fog (gas)"					"saycommand [/fogcolour 40 60 45]"
		guibutton 	"^foRESET ^fwfog color to default"	"saycommand [/fogcolour 128 153 179]"
		
	guitab skybox
		guitext 	"^fo/skybox ^fyfolder/filename"
		guibutton 	"set skybox to skyhigh"			"saycommand [/skybox skyboxes/skyhigh]"
		guibutton 	"set skybox to sunsetflat"		"saycommand [/skybox skyboxes/sunsetflat]"
		guibutton	"set skybox to gradient"		"saycommand [/skybox skyboxes/gradient]"
		guibutton 	"^foREMOVE ^fwskybox"  			[saycommand "/skybox ^"^""]
		guitext
		guitext
		guitext		"^fo/skycolour ^frR ^fgG ^fbB"
		guibutton	"set sky color to orange"		"saycommand [/skycolour 255 150 20]"
		guibutton	"set sky color to yellow"		"saycommand [/skycolour 150 150 80]"
		guibutton	"set sky color to red"			"saycommand [/skycolour 180 80 80]"
		guibutton	"set sky color to blue"			"saycommand [/skycolour 80 80 180]"
		guibutton	"set sky color to black"		"saycommand [/skycolour 80 80 80]"
		guibutton 	"^foRESET ^fwsky color"			"saycommand [/skycolour 255 255 255]"
		
	guitab clouds 
		guitext 	"^fo/cloudlayer ^fyfolder/filename"
		guibutton 	"set clouds to clouds01"			"saycommand [/cloudlayer skyboxes/clouds01]"
		guibutton 	"set clouds to clouds02"			"saycommand [/cloudlayer skyboxes/clouds02]"
		guibutton 	"set clouds to clouds03"			"saycommand [/cloudlayer skyboxes/clouds03]"
		guibutton 	"^foREMOVE ^fwcloudlayer" 			[saycommand "/cloudlayer^"^""]
		guitext
		guitext
		guitext		"^fo/cloudlayercolour ^frR ^fgG ^fbB"
		guibutton	"set cloud color to orange"		"saycommand [/cloudlayercolour 255 150 20]"
		guibutton	"set cloud color to yellow"		"saycommand [/cloudlayercolour 150 150 80]"
		guibutton	"set cloud color to red"		"saycommand [/cloudlayercolour 180 80 80]"
		guibutton	"set cloud color to blue"		"saycommand [/cloudlayercolour 80 80 180]"
		guibutton	"set cloud color to black"		"saycommand [/cloudlayercolour 80 80 80]"
		guibutton 	"^foRESET ^fwcloud color"		"saycommand [/skycolour 255 255 255]"ss
	
		guitab vars
		guitext	"^fo/gravity ^fy%"
		guibutton	"none"								"saycommand	[/gravity 5.0]"
		guibutton	"low"								"saycommand [/gravity 15.0]"
		guibutton	"default"							"saycommand [/gravity 50.0]"
		guitext
		
		guitext "^fo/spawnweapon ^fy#"
		guilist [
			guilist [
			guibutton "sword"			"saycommand	[/spawnweapon 2]"
			guibutton "shotgun"			"saycommand	[/spawnweapon 3]"
			guibutton "smg"				"saycommand	[/spawnweapon 4]"
			guibutton "flamer"			"saycommand	[/spawnweapon 5]"
			]
		
			guilist [
			guibutton "			plasma"				"saycommand	[/spawnweapon 6]"
			guibutton "			rifle"				"saycommand	[/spawnweapon 7]"
			guibutton "			grenade"			"saycommand	[/spawnweapon 8]"
			guibutton "			rocket"				"saycommand	[/spawnweapon 9]"
			]
		]
			guitext
			guitext	"^foplayer vars"
			guibutton "maximum inventory (default 2)"		"saycommand [/maxcarry 5 0]"
			guibutton "jumpspeed (default 100)" 			"saycommand [/jumpspeed 200]
			guibutton "impulse freestyle (default 1)"		"saycommand [/impulsestyle 3]"

	guibutton "show all variables.."			"showgui vars"
	
	]
]
resetlight = [
    lightcolour = 0
    lightrgb = "255 255 255"
    lightbright = 1
    lightradius = 128
]

lightcmd = [
    lightr = (at $lightrgb 0)
    lightg = (at $lightrgb 1)
    lightb = (at $lightrgb 2)
    if (= $lightbright 0) [
        if (strcmp $lightrgb "255 255 255") [
            lightr = 192; lightg = 192; lightb = 192
        ] [
            lightr = (div $lightr 2); lightg = (div $lightg 2); lightb = (div $lightb 2)
         ]
    ]
    result (concat newent light $lightradius $lightr $lightg $lightb)
]

newgui newlight [
    guibutton "create a sunlight entity          "    	"saycommand [/newent sunlight 45 320 100 70 50]"
	guitext
    guitext "light radius:"
    guislider lightradius 0 800	
    guiradio "white"       						lightcolour 0 [lightrgb = "150 150 150"]
    guiradio "blue"         					lightcolour 1 [lightrgb = "80 80 180"]
    guiradio "red"          					lightcolour 2 [lightrgb = "180 80 80"]
    guiradio "green"        					lightcolour 3 [lightrgb = "80 180 80"]
    guiradio "yellow"       					lightcolour 4 [lightrgb = "150 150 80"]
    guiradio "purple"       					lightcolour 5 [lightrgb = "150 80 150"]
    guiradio "turquoise"    					lightcolour 6 [lightrgb = "80 150 150"]
	guitext
	guicheckbox "bright"    					lightbright
	guitext
	guibutton "^foCREATE" (lightcmd)
	guibutton (lightcmd)
]


newgui newteleport [
	guitext "^fo/newent teleport ^fwlink teleports with ^fo/entlink ^fw(key L)"
    guitext
	guibutton "create a new teleport" 			"saycommand [/newent teleport -1 0 0 0 655 0]"
]

macro resbutton [
    guibutton "%1x%2" "screenres %1 %2" [] (if (&& (= $scr_w %1) (= $scr_h %2)) [result "radioboxon"] [result "radiobox"])
]



newgui options [
	guiautotab 15
    guitext "performance key: ^fgfast^f~, ^fymoderate^f~, ^foslow and pretty^f~"
    guibar
    if (&& (< $shaders 0) (= $renderpath 0)) [
        guicheckbox "^fyshaders         "           shaders 1 -1
    ] [
        guilist [
            guicheckbox "^fyshaders			"           shaders
            if $shaders [
                guibar
                guiradio "^fglow detail " shaderdetail 1
                guiradio "^fyhigh detail " shaderdetail 3
                //if $hasglsl [
                //    guicheckbox "^foGLSL only" forceglsl
                //]
            ]
        ]
    ]
    guilist [
        guitext "water			" blank
        guibar
        guicheckbox "^fyrefraction "  waterrefract
        guicheckbox "^foreflection "  waterreflect
        guicheckbox "^fgcaustics "    caustics
    ]
    if (> $renderpath 0) [
        guilist [
            guitext "waterfalls		" blank
            guibar
            guicheckbox "^fyrefraction " waterfallrefract
            guicheckbox "^fgreflection " waterfallenv
        ]
    ]
    if (= $renderpath 0) [
        guilist [
            guicheckbox "^foshadow maps		"  shadowmap
            if $shadowmap [
                guibar
                guiradio "^fymedium quality " shadowmapsize 9 [blurshadowmap 1]
                guiradio "^fohigh quality " shadowmapsize 10 [blurshadowmap 2]
            ] [
                guibar
                guicheckbox "^fgblob shadows " blobs
            ]
        ]
        if (>= $maxtmus 3) [
            guicheckbox "^fydynamic lights"    ffdynlights 5 0
        ]
    ] [
        guilist [
            guicheckbox "^fosoft shadows		"  shadowmap
            if $shadowmap [
                guibar
                guiradio "^fymedium quality " shadowmapsize 9 [blurshadowmap 1]
                guiradio "^fohigh quality " shadowmapsize 10 [blurshadowmap 2]
            ] [
                guibar
                guicheckbox "^fgblob shadows " blobs
            ]
        ]
        if $glare [
            glarepreset = 0
            if (= $glarescale 1) [
                if (= $blurglare 4) [glarepreset = 1]
                if (= $blurglare 7) [glarepreset = 3]
            ]
            if (= $glarescale 2) [
                if (= $blurglare 3) [glarepreset = 2]
                if (= $blurglare 7) [glarepreset = 4]
            ]
            guilist [
                guicheckbox "^foglare			"       glare
                guibar
                guiradio "^fysubtle " glarepreset 1 [blurglare 4; glarescale 1]
                guiradio "^fyglowy " glarepreset 2 [blurglare 3; glarescale 2]
                guiradio "^fosoft " glarepreset 3 [blurglare 7; glarescale 1]
                guiradio "^fointense " glarepreset 4 [blurglare 7; glarescale 2]
            ]
        ] [
            guicheckbox "^foglare"         glare
        ]
    ]
    if $usetexrect [
        guilist [
            guicheckbox "^fomotion blur		" motionblur
            if $motionblur [
                guibar
                guiradio "^fosubtle " motionblurscale 0.5
                guiradio "^fomoderate " motionblurscale 1
            ]
        ]
    ]
    guilist [
        guicheckbox "^fograss			" grass
        if $grass [
            guibar
            guiradio "^fyquick fade " grassdist 128
            guiradio "^fymoderate fade " grassdist 256
            guiradio "^foslow fade " grassdist 512
        ]
    ]
    if (> $renderpath 0) [
        guilist [
            guicheckbox "^fgdynamic lights		"    maxdynlights 3 0
            if $maxdynlights [
                guibar
                guiradio "^fgmedium quality " maxdynlights 3
                guiradio "^fyhigh quality " maxdynlights 5
            ]
        ]
        guilist [
            guicheckbox "^fysoft particles		" depthfx
            if $depthfx [
                guibar
                guiradio "^fglow quality " depthfxsize 7 [depthfxrect 0; depthfxfilter 1; blurdepthfx 1]
                guiradio "^fymedium quality " depthfxsize 10 [depthfxrect 1; depthfxfilter 0; blurdepthfx 0]
                guiradio "^fohigh quality " depthfxsize 12 [depthfxrect 1; depthfxfilter 0; blurdepthfx 0]
            ]
        ]
    ]
    guicheckbox "^fgglass reflection"  glassenv
    guilist [
        guicheckbox "^fgdecals			" decals
        if $decals [
            guibar
            guiradio "^fgmedium quality " maxdecaltris 1024
            guiradio "^fyhigh quality " maxdecaltris 4096
        ]
    ]
    guicheckbox "^fgfix t-joints (world sparklies)" filltjoints
    guilist [
        guitext "textures			" blank
        guibar
        guiradio "^fglow quality " maxtexsize 256
        guiradio "^fgmedium quality" maxtexsize 512
        guiradio "^fyhigh quality " maxtexsize 0
    ]
    guilist [
        guitext "models			" blank
        guibar
        guicheckbox "^fglighting "    lightmodels
        guicheckbox "^fgreflection "  envmapmodels
        guicheckbox "^fgglow "        glowmodels
        if (> $renderpath 0) [
            guicheckbox "^fybumpmap " bumpmodels
        ]
    ]
    guilist [
        guitext "animation		" blank
        guibar
        guiradio "^fgmedium quality " matskel 1
        guiradio "^fghigh quality " matskel 0
    ]

    guitab    "display"
    guicheckbox "v-sync"            vsync 1 0
    guicheckbox "fullscreen"        fullscreen
    guitext "gamma (default: 100)"
    guislider gamma
    guitext "full-scene anti-aliasing (default: -1)"
    guilistslider fsaa "-1 0 2 4 8 16"
    guitext "color depth (default: 0)"
    guilistslider colorbits "0 8 16 24 32"
    guitext "z-buffer depth (default: 0)"
    guilistslider depthbits "0 8 16 24 32"
    guitext "stencil bits (default: 0)"
    guislider stencilbits
    guitext "anisotropic filtering (default: 0)"
    guilistslider aniso "0 2 4 8 16"

    guitab   "ui"
	guilist [
		guicheckbox "show crosshair " showcrosshair
		guicheckbox "weapon crosshairs " crosshairweapons
	]
    guilist [
		guicheckbox "show clips " showclips
		guicheckbox "show radar " showradar
	]
    guibar
    guilist [
      guitext "crosshair size: "
      crosshairsizestorage = $crosshairsize
      guifield crosshairsizestorage 6 [crosshairsize $crosshairsizestorage]
      guitext " (0 - 1000, default: 0.05)"
    ]
    guilist [
      guitext "zoom crosshair size: "
      zoomcrosshairsizestorage = $zoomcrosshairsize
      guifield zoomcrosshairsizestorage 6 [zoomcrosshairsize $zoomcrosshairsizestorage]
      guitext " (0 - 1000, default: 0.575)"
    ]
    guibar
    guitext "notice messages"
    guilist [
    guilist [
      guiradio "off" shownotices 0
      guiradio "basic notices" shownotices 1
      guiradio "level 2" shownotices 2
      guiradio "level 3" shownotices 3
      guiradio "everything" shownotices 4
    ]
    guibar
    guilist [
      guitext "fps display"
      guiradio "off" showfps 0
      guiradio "number only" showfps 1
      guiradio "verbose" showfps 2
      guiradio "more verbose" showfps 3
    ]
    ]

    guitab   "res"
    guistayopen [
      guilist [
        guilist [
            guitext "4:3"
            @@@@(resbutton 320 240)
            @@@@(resbutton 640 480)
            @@@@(resbutton 800 600)
            @@@@(resbutton 1024 768)
            @@@@(resbutton 1152 864)
            @@@@(resbutton 1280 960)
            @@@@(resbutton 1400 1050)
            @@@@(resbutton 1600 1200)
            @@@@(resbutton 1792 1344)
            @@@@(resbutton 1856 1392)
            @@@@(resbutton 1920 1440)
            @@@@(resbutton 2048 1536)
            @@@@(resbutton 2800 2100)
            @@@@(resbutton 3200 2400)
        ]
        guibar
        guilist [
            guitext "16:10"
            @@@@(resbutton 320 200)
            @@@@(resbutton 640 400)
            @@@@(resbutton 1024 640)
            @@@@(resbutton 1280 800)
            @@@@(resbutton 1440 900)
            @@@@(resbutton 1600 1000)
            @@@@(resbutton 1680 1050)
            @@@@(resbutton 1920 1200)
            @@@@(resbutton 2048 1280)
            @@@@(resbutton 2560 1600)
            @@@@(resbutton 3840 2400)
        ]
        guibar
        guilist [
            guitext "16:9"
            @@@@(resbutton 1024 600)
            @@@@(resbutton 1280 720)
            @@@@(resbutton 1366 768)
            @@@@(resbutton 1600 900)
            @@@@(resbutton 1920 1080)
            @@@@(resbutton 2048 1152)
            @@@@(resbutton 3840 2160)
        ]
        guibar
        guilist [
            guitext "5:4"
            @@@@(resbutton 600 480)
            @@@@(resbutton 1280 1024)
            @@@@(resbutton 1600 1280)
            @@@@(resbutton 2560 2048)
        ]
        guibar
        guilist [
            guitext "5:3"
            @@@@(resbutton 800 480)
            @@@@(resbutton 1280 768)

            guibar
            guitext "Custom"
            guilist [
                customw = $scr_w
                customh = $scr_h
                guifield customw 4 [scr_w $customw]
                guifield customh 4 [scr_h $customh]
            ]
        ]
      ]
    ]

    guitab   "sound"
    guitext "master volume"
    guislider mastervol
    guitext "sound volume"
    guislider soundvol
    guitext "music volume"
    guislider musicvol
    guitext "sound channels"
    guislider soundchans
    guitext "sound frequency"
    guilistslider soundfreq "11025 22050 44100"
    guitext "sound buffer length"
    guislider soundbufferlen
	guilist [
            guilist [
				guitext "in-game music		"
				]
			guilist [
				guilist [
					guiradio "off	" 		musictype 0
					guiradio "mapmusic	" 	musictype 1
					guiradio "random	" 	musictype 2
					]
				]
			]
	guilist [
            guilist [
				guitext "edit mode music	"
				]
			guilist [
				guilist [
					guiradio "off	" 		musicedit 0
					guiradio "mapmusic	" 	musicedit 1
					guiradio "random	" 	musicedit 2
					]
				]
			]
	guitext
    guicheckbox "mumble positional audio" mumble

    guitab  "mouse"
    guilist [
        guilist [
            guitext "mouse input style "
            guitext "mouse overall sensitivity  "
            guitext "mouse yaw sensitivity"
            guitext "mouse pitch sensitivity"
            guistrut 1
            guicheckbox "invert y-axis" mouseinvert
        ]
        guilist [
            guilist [
                guiradio "default " mousetype 0
                guiradio "panned " mousetype 1
                guiradio "free " mousetype 2
            ]
            guislider sensitivity 1 100
            guislider yawsensitivity 0 100
            guislider pitchsensitivity 1 100
            guistrut 1
            guicheckbox "absolute movements" mouseabsolute
        ]
    ]

    guitab  "keys"
    guitext "basic keybinds, for anything more use the 'bind' command"
    guitext "select action to bind and press desired keys (ESC when done):"
    guistrut 1
    guilistsplit n 2 $bindactions [
        guilist [
            guitext (tabify (concatword (at $bindnames $i) " ") 4)
            [newbinds@i] = (searchbinds $n)
            guikeyfield [newbinds@i] -24 [
                oldbinds = (searchbinds [@@n])
                looplist j $oldbinds [bind $j ""]
                looplist j $[newbinds@@i] [bind $j [@@@n]]
            ]
        ]
    ] [guistrut 2]
    
    guitab "autoexec.cfg"
    guitext "autoexec.cfg"
    showfileeditor "autoexec.cfg" -80 20
	
]
newgui postfx [
    guibutton "(effect OFF)"          "clearpostfx"
    guibutton "bloom (subtle: 30%)"    "bloom 0.3"
    guibutton "bloom (bright: 55%)"    "bloom 0.55"
    guibutton "bloom (intense: 80%)"  "bloom 0.8"
    guibutton "rotoscope" "rotoscope 1"
    guibutton "rotoscope + blur3" "rotoscope 1 1"
    guibutton "rotoscope + blur5" "rotoscope 1 2"
    guibutton "sobel"  "setpostfx sobel"
    guibutton "invert" "setpostfx invert"
    guibutton "gbr"    "setpostfx gbr"
    guibutton "bw"     "setpostfx bw"
    guibutton "blur3"  "setpostfx hblur3; addpostfx vblur3"
    guibutton "blur5"  "setpostfx hblur5; addpostfx vblur5"
]

bindactions = [
    forward backward left right "universaldelta 1" "universaldelta -1" "spectator 1" "spectator 0"
    "action 0" "action 1" "action 2" "action 3" "action 4" "action 5" "action 6" "action 7" "action 8" "action 9"
    "weapon 0" "weapon 1" "weapon 2" "weapon 3" "weapon 4" "weapon 5" "weapon 6" "weapon 7" "weapon 8" "weapon 9"
    "saycommand /" saytextcommand sayteamcommand toggleconsole edittoggle takescreenshot
    addbot delbot "showgui maps 1" "showgui maps 2" "setmaster 1" "showgui loadout" "showgui team"
    "showcompass voice" "showcompass team"
]
bindnames = [
    forward backward left right "scroll up" "scroll down" "enter spectator" "exit spectator"
    "attack" "alt-attack" "reload" "use" "jump" "run/walk" "crouch" "special" "drop" "affinity"
    "melee" "pistol" "sword" "shotgun" "smg" "flamer" "plasma" "rifle" "grenade" "rocket"
    "cmd input" "all chat" "team chat" "toggle console" "toggle editing" "screenshot"
    "add bot" "delete bot" "maps menu" "maps voting" "claim master" "loadout menu" "team menu"
    "voice compass" "team compass"
]

entupdate = [ entset $tmpt $tmp0 $tmp1 $tmp2 $tmp3 ]

initentgui = [
  tmpt = ( et )
  tmp0 = ( ea 0 )
  tmp1 = ( ea 1 )
  tmp2 = ( ea 2 )
  tmp3 = ( ea 3 )
]

genentattributes = [
    entattributes = ""
    n = (listlen $arg2)
    loop i $n [
        entattributes = (concat $entattributes [
            guitext @(at $arg2 $i)
            guislider tmp@i @(at $arg3 (* 2 $i)) @(at $arg3 (+ 1 (* 2 $i))) entupdate
        ])
    ]
]

guilistsplit = [
  guilist [
    i = 0
    l = (listlen $arg3)
    z = (div (+ $l (- $arg2 1)) $arg2)
    loop a $arg2 [
      guilist [
        t = (min (+ $i $z) $l)
        while [< $i $t] [
          $arg1 = (at $arg3 $i)
          arg4
          i = (+ $i 1)
        ]
      ]
      if (&& (>= $numargs 5) (< (+ $a 1) $arg2)) [arg5]
    ]
  ]
]

quickeditmenu = [
  guitext "Quick Commands:"
  guibar
  guifield  savemap_name 10 [ savemap $savemap_name ]
  guibutton quicklight          "calclight -1"
  guibutton "optimize map"      "remip"
  guibutton "new entity"        "newent light"
  guibar
  guibutton newmap
  guibar
  guibutton help "showgui editing"
]

matmenu = [
		guicheckbox		"show material volumes		   key M"			"showmat"
		guitext
		guibutton	"air							key Numpad 1"					"editmat air"
		guibutton	"alpha						key Numpad 2"						"editmat alpha"
		guibutton	"water						key Numpad 3"						"editmat water"
		guibutton	"lava							key Numpad 4"					"editmat lava"
		guibutton	"clip							key Numpad 5"					"editmat clip"
		guibutton	"noclip						key Numpad 6"						"editmat noclip"
		guibutton	"aiclip						key Numpad 7"						"editmat aiclip"
		guibutton	"death						key Numpad 8"						"editmat death"
		guibutton	"ladder						key Numpad 9"						"editmat ladder"

]

newentgui = [
  genentattributes [@arg1] [@arg2] [@arg3]
  newgui $arg1 [
    guitext $tmpt
    guibar
    @entattributes
    guitab type
    guilistsplit n 2 $enttypelist [
        guibutton $n [ entset @n ]
    ]

  ]
]

loop i $enttypelength [
  newentgui (at $enttypelist $i) "" ""
]

newgui materials [
  @matmenu

]

newgui quickedit [
  @quickeditmenu
  guitab materials
  @matmenu
]

newentgui light "radius red green blue" "0 400 0 255 0 255 0 255"
newentgui spotlight "radius" "0 200"
newentgui playerstart "yaw team id" "0 360"
newentgui teleport "tag" "0 20"
newentgui teledest "yaw tag" "0 360 0 20"
newentgui monster "yaw type" "0 360 0 7"
newentgui mapmodel "model yaw type tag flags" "360 0 0 100 0 29 0 20"
newentgui envmap "radius" "0 400"
newentgui pusher "Z Y X" "0 200 0 200 0 200"
newentgui carrot "tag type" "0 50 0 29"
newentgui sound "type radius size" "0 20 0 500 0 500"
newentgui particles "type" "0 3"

guilistloop = [
    i = 0
    j = (+ (div $arg3 (* $arg1 $arg2)) 1)
    loop a $j [
        if (> $a 0) [ guitab $a ]
        guilist [
            loop b $arg1 [
                guilist [
                    loop c $arg2 [
                        if (< $i $arg3) [
                            arg4; i = (+ $i 1)
                            if (< $c (- $arg2 1)) [ guibar ]
                        ]
                    ]
                ]
                if (&& (< $i $arg3) (< $b (- $arg1 1))) [ guibar ]
            ]
        ]
    ]
]

alias showmapmodel [
    mapmodelpath = (mapmodelindex $arg1)
    mapmodelshot = (concatword "models/" $mapmodelpath "/thumb")
    mapmodelcmd = (concat newent mapmodel $arg1)
    guilist [ guilist [
        guiimage $mapmodelshot $mapmodelcmd 2 1 "textures/nothumb"
        guibutton $mapmodelpath $mapmodelcmd
    ] ]
]

newgui mapmodels [
    mapmodelnum = (mapmodelindex)
    guilistloop 4 2 $mapmodelnum [ showmapmodel $i ]
]