#!/bin/bash
#
# "$1" is data/usage.cfg
# "$2" is doc/wiki-all-vars-commands.txt

DIR="$(cd "$(dirname "$0")" && pwd)"

source "$DIR"/wiki-common

diff -u0 \
    <(sed "$1" -n -e 's%\^\^%^%' -e 's%setdesc "\([^"]*\)".*%\1%p' -e 's% *setdesc (concatword $w \([^ ^)]*\).*%[weap]\1%p' | sort) \
    <(sed "$2" -n -e "s%'''<nowiki>\(.*\)<\/nowiki>'''.*%\1%p" | sed -e 's%^| %%' -e 's%<nowiki>\([^<]*\)<\/nowiki>%\1%' -e 's%\^\^%^%' | sort) \
    || exit 1
